"undefined"==typeof fc_cfg&&(fc_cfg=window.fc_cfg||{});const fc_offsetMinutes=(new Date).getTimezoneOffset();function fc_formatOffset_fnc(e){const c=e<=0?"+":"-",n=Math.abs(e);return`${c}${String(Math.floor(n/60)).padStart(2,"0")}:${String(n%60).padStart(2,"0")}`}let fc_offset=fc_formatOffset_fnc(fc_offsetMinutes),fc_initialized=!1;fc_base_url="https://widgets.fishingcab.com/Widgets/",fc_cdn_url="https://cdn-widgets.fishingcab.com/";let fc_push_users={},fc_push_rooms={},fc_push_nearby={},fc_push_chats={},fc_push_messages={},fc_push_notifications={},fc_user_id=0,fc_latitude=window.fc_lat||0,fc_longitude=window.fc_lon||0,fc_self_info={};if("undefined"==typeof fc_cfg){window.fc_cfg}let fc_missingChats={},fc_missingUsers={};function fc_safeText_fnc(e){const c=document.createElement("span");return c.textContent=e??"",c.textContent}function fc_el_fnc(e,c,n={}){const t=document.createElement(e);c&&(t.className=c);for(const e in n)"text"===e?t.textContent=n[e]:t.setAttribute(e,n[e]);return t}window.fc_unread_messages||(window.fc_unread_messages=new Map),window.fc_unseen_notifications||(window.fc_unseen_notifications=0),window.fc_sound_muted||(window.fc_sound_muted=!1);const fc_qs_fnc=(e,c=document)=>c.querySelector(e),fc_qsa_fnc=(e,c=document)=>c.querySelectorAll(e);function fc_retry_lookup_fnc(e,c,n,t=3){return e[n]?(delete c[n],e[n]):(c[n]=(c[n]||0)+1,c[n]>=t&&(delete e[n],delete c[n]),null)}const fc_removeElement_fnc=(e,c=300)=>{if(!(e instanceof Element))return;e.style.transition=`opacity ${c}ms ease, transform ${c}ms ease`,e.style.opacity="0",e.style.transform="scale(0.95)";const n=()=>{e&&e.parentNode&&e.remove()};e.addEventListener("transitionend",n,{once:!0}),setTimeout(n,c+100)};function fc_fragment_fnc(){return document.createDocumentFragment()}function fc_toggle_controls_fnc(e,c){e.forEach((e=>e.disabled=c))}async function fc_doUpdates_fnc(e,c,n,t){if(!fc_cfg||!fc_cfg.widget_id)return;if(!e||!0!==e.status)return fc_alert_fnc("Warning: Invalid response","warning"),!1;const i=e.data||{};if(i.users&&Object.keys(i.users).length>0){const e=i.users;fc_push_users={...fc_push_users,...e};const c=new IndexedDBWrapper(n,"users");await c.init();const f=[];for(const[i,o]of Object.entries(e)){if(!o||!o.user_id||!o.public_key)continue;const e={id:i,...o};o.public_key===n&&(fc_self_info=o,fc_user_id=o.user_id,requestAnimationFrame((()=>{fc_updateSelf_fnc(fc_self_info,n,t)}))),f.push((async()=>{try{await c.save(e)}catch(e){}})())}await Promise.all(f)}if(i.rooms&&Object.keys(i.rooms).length>0){const e=i.rooms;fc_push_rooms={...fc_push_rooms,...e};const c=new IndexedDBWrapper(n,"rooms");await c.init();const f=[];for(const[i,o]of Object.entries(e)){if(!o||!o.room_id)continue;const e={id:i,...o};requestAnimationFrame((async()=>{await fc_wrap_room_fnc(o,n,t)})),f.push((async()=>{try{await c.save(e)}catch(e){}})())}await Promise.all(f)}if(i.nearby&&Object.keys(i.nearby).length>0){const e=i.nearby,c=Object.fromEntries(Object.values(e).map((e=>[e.user_id,e])));fc_push_nearby={...fc_push_nearby,...c};const f=fc_qs_fnc(`#fc-nearby-${fc_cfg.widget_id}`);f&&(f.innerHTML="");const o=fc_fragment_fnc();Object.values(e).forEach((async e=>await fc_wrap_nearby_fnc(e,o,n,t))),f&&o.childNodes.length>0&&f.appendChild(o)}return setTimeout((async()=>{if(i.chats&&Object.keys(i.chats).length>0){const e=i.chats;fc_push_chats={...fc_push_chats,...e};const f=new IndexedDBWrapper(n,"chats");await f.init();for(const[o,d]of Object.entries(e)){if(!d||!d.chat_id)continue;try{const e={id:o,...d};await f.save(e)}catch(e){}let e,s;0===Number(d.room_id)?(e="user",s=d.user_id===fc_user_id?fc_push_users?.[d.recipient_id]:fc_push_users?.[d.user_id]):(e="room",s=fc_push_rooms?.[d.room_id]),await fc_chat_update_fnc(d,s,n,t),await fc_start_chat_fnc(d.chat_id,e,n,t,!1);const _=i.messages?.[d.chat_id];if(_&&Object.keys(_).length>0){const e=new IndexedDBWrapper(n,"messages");await e.init();const i=fc_fragment_fnc(),f=[];for(const[o,d]of Object.entries(_))d&&d.message_id>0&&(f.push((async()=>{try{await e.save({id:o,...d})}catch(e){}})()),fc_display_message_fnc(d,c,i,n,t));await Promise.all(f);const o=fc_qs_fnc(`#fc-conversation-${d.chat_id}`);o&&i.childNodes.length>0&&requestAnimationFrame((()=>{o.appendChild(i),o.parentElement.scrollTop=o.parentElement.scrollHeight}))}}}}),50),setTimeout((async()=>{if(i.messages&&Object.keys(i.messages).length>0){const e=new IndexedDBWrapper(n,"messages");await e.init();const f=i.messages,o=[];Object.values(f).forEach((i=>{Object.values(i).forEach((i=>{o.push((async()=>{try{await e.save({id:i.message_id,...i})}catch(e){}})()),fc_display_message_fnc(i,c,null,n,t)}))})),await Promise.all(o)}}),300),setTimeout((async()=>{if(i.all_push&&Object.keys(i.all_push).length>0){const e=new IndexedDBWrapper(n,"push");await e.init();const c=[];Object.values(i.all_push).forEach((async i=>{c.push((async()=>{try{await e.save({id:i.push_id,...i})}catch(e){}})()),await fc_push_fnc(i,n,t)})),await Promise.all(c)}}),550),setTimeout((async()=>{if(i.notifications&&Object.keys(i.notifications).length>0){const e=i.notifications;fc_push_notifications={...fc_push_notifications,...e};const c=new IndexedDBWrapper(n,"notifications");await c.init();const f=[];Object.values(e).forEach((e=>{f.push((async()=>{try{await c.save({id:e.notification_id,...e})}catch(e){}})()),fc_addNotification_fnc(e,n,t)})),await Promise.all(f)}}),850),!0}function fc_addNotification_fnc(e,c,n){if(!fc_cfg?.widget_id||!e)return;const t=fc_cfg.widget_id,i=document.getElementById(`fc-notifications-${t}`);if(!i)return;const f=`fc-notification-${e.notification_id}`;if(document.getElementById(f))return;const o=2!==Number(e.notification_status),d=document.createElement("li");o&&d.classList.add(`fc-unread-${t}`),d.id=f;const s=document.createElement("p"),_=fc_contentNotification_fnc(e,c,n);_&&(s.innerHTML=_,s.setAttribute("role","alert"),d.appendChild(s),i.prepend(d),o&&d.addEventListener("mouseover",(()=>{fc_send_tmp_fnc(e.notification_id,"seen",c,n)}),{once:!0}),o&&(window.fc_unseen_notifications=(window.fc_unseen_notifications||0)+1,fc_countNotification_fnc(c,n)))}function fc_contentNotification_fnc(e,c,n){if(!fc_cfg?.widget_id||!e)return"";switch(e.parent_type){case"received_chat_request":{const t=fc_push_users?.[e.parent_id];if(!t)return fc_missingUsers[e.parent_id]=(fc_missingUsers[e.parent_id]||0)+1,fc_missingUsers[e.parent_id]>=3&&(delete fc_push_users[e.parent_id],delete fc_missingUsers[e.parent_id]),"";delete fc_missingUsers[e.parent_id];let i="Profile",f=!1;return 0===t.blocked&&1===t.chat_request&&(i="Chat Request",f=!0),`\n          <a href="javascript:void(0)" \n            onclick="fc_view_profile_fnc('${i}', '${t.user_id}', false, ${f}, '${c}', '${n}')">\n            ${t.nickname}\n          </a> sent you a chat request.\n        `}case"accept_chat_request":{const t=fc_push_users?.[e.parent_id];return t?(delete fc_missingUsers[e.parent_id],`<a href="javascript:void(0)" onclick="fc_view_profile_fnc('Profile', '${t.user_id}', false, false, '${c}', '${n}')">${t.nickname}</a> accepted your chat request.`):(fc_missingUsers[e.parent_id]=(fc_missingUsers[e.parent_id]||0)+1,fc_missingUsers[e.parent_id]>=3&&(delete fc_push_users[e.parent_id],delete fc_missingUsers[e.parent_id]),"")}default:return""}}function fc_countNotification_fnc(e,c){if(!fc_cfg?.widget_id)return!1;const n=fc_cfg.widget_id,t=document.getElementById(`fc-notifications-badge-${n}`),i=document.getElementById(`fc-notifications-icon-${n}`);if(!t||!i)return!1;const f=Number(window.fc_unseen_notifications)||0;return f>0?(t.textContent=f,t.classList.add(`fc-badge-${n}`),t.style.display="inline-block",i.classList.add(`fc-unread-${n}`)):(t.textContent="",t.classList.remove(`fc-badge-${n}`),t.style.display="none",i.classList.remove(`fc-unread-${n}`),window.fc_unseen_notifications=0),!0}async function fc_push_fnc(e,c,n){const t=e.parent_type;switch(t){case"room_exit":case"room_admin":case"room_join":{const i=e.sub_id,f=fc_push_users?.[i];if(!f)return fc_missingUsers[i]=(fc_missingUsers[i]||0)+1,fc_missingUsers[i]>=3&&(delete fc_push_users[i],delete fc_missingUsers[i],!0);delete fc_missingUsers[i];const o=e.parent_id,d=fc_push_chats?.[o];if(!d)return fc_missingChats[o]=(fc_missingChats[o]||0)+1,fc_missingChats[o]>=3&&(delete fc_push_chats[o],delete fc_missingChats[o],!0);delete fc_missingChats[o];let s="";"room_exit"===t?s="left the room":"room_admin"===t?s="is now an admin of the room":"room_join"===t&&(s="has joined the room");return fc_display_message_fnc({message_id:e.push_id,chat_id:o,user_id:i,message_type:"system",message_content:`${f.nickname} ${s}`},"system",null,c,n),!0}case"chat_request":{const t=fc_push_users?.[e.parent_id];return t?(delete fc_missingUsers[e.parent_id],fc_sound_fnc("notification"),fc_view_profile_fnc("New Chat Request",e.parent_id,!1,!0,c,n),await new Promise((e=>{setTimeout((()=>{e(!0)}),1e3)})),!0):(fc_missingUsers[e.parent_id]=(fc_missingUsers[e.parent_id]||0)+1,fc_missingUsers[e.parent_id]>=3&&(delete fc_push_users[e.parent_id],delete fc_missingUsers[e.parent_id],!0))}case"chat_accept":{const t=fc_push_users?.[e.parent_id];return t?(delete fc_missingUsers[e.parent_id],fc_view_profile_fnc("Chat Request Accepted",e.parent_id,!1,!1,c,n),await new Promise((e=>{setTimeout((()=>{e(!0)}),1e3)})),!0):(fc_missingUsers[e.parent_id]=(fc_missingUsers[e.parent_id]||0)+1,fc_missingUsers[e.parent_id]>=3&&(delete fc_push_users[e.parent_id],delete fc_missingUsers[e.parent_id],!0))}case"chat_start":case"chat_update":{const t=fc_push_chats?.[e.parent_id];if(!t)return fc_missingChats[e.parent_id]=(fc_missingChats[e.parent_id]||0)+1,fc_missingChats[e.parent_id]>=3&&(delete fc_push_chats[e.parent_id],delete fc_missingChats[e.parent_id],!0);let i,f;return delete fc_missingChats[e.parent_id],"chat_start"===e.parent_type&&fc_sound_fnc("notification"),0===Number(t.room_id)?(i="user",f=t.user_id===fc_user_id?fc_push_users?.[t.recipient_id]:fc_push_users?.[t.user_id]):(i="room",f=fc_push_rooms?.[t.room_id]),fc_chat_update_fnc(t,f,c,n),fc_start_chat_fnc(e.parent_id,i,c,n,!1),await new Promise((e=>{setTimeout((()=>{e(!0)}),1e3)})),!0}case"chat_remove":{const c=fc_push_chats?.[e.parent_id];if(!c)return fc_missingChats[e.parent_id]=(fc_missingChats[e.parent_id]||0)+1,fc_missingChats[e.parent_id]>=3&&(delete fc_push_chats[e.parent_id],delete fc_missingChats[e.parent_id],!0);delete fc_missingChats[e.parent_id];const n=document.getElementById(`fc-input-${e.parent_id}`);if(!n)return!1;fc_toggle_controls_fnc(Array.from(n.querySelectorAll(":scope input, :scope button, :scope textarea, :scope select")),!0);const t=`#fc-chat-win-${e.parent_id}`,i=`#fc-chat-${e.parent_id}`,f=fc_qs_fnc(t);if(!f)return!1;fc_removeElement_fnc(f,300);const o=fc_qs_fnc(i);return!!o&&(fc_removeElement_fnc(o,300),await new Promise((e=>{setTimeout((()=>{e(!0)}),1e3)})),!0)}case"notification_remove":{const c=`#fc-notification-${e.parent_id}`,n=fc_qs_fnc(c);return n&&fc_removeElement_fnc(n,300),!0}case"messages_remove":{const c=fc_push_chats?.[e.parent_id];if(!c)return fc_missingChats[e.parent_id]=(fc_missingChats[e.parent_id]||0)+1,fc_missingChats[e.parent_id]>=3&&(delete fc_push_chats[e.parent_id],delete fc_missingChats[e.parent_id],!0);delete fc_missingChats[e.parent_id];const n=document.getElementById(`fc-input-${e.parent_id}`);if(!n)return!1;const t=Array.from(n.querySelectorAll(":scope input, :scope button, :scope textarea, :scope select"));fc_toggle_controls_fnc(t,!0);const i=`#fc-conversation-${e.parent_id}`,f=`.user-${e.sub_id}`,o=fc_qs_fnc(`#fc-preview-${e.parent_id}`);o&&(o.innerHTML="");const d=fc_qs_fnc(i);if(d){fc_qsa_fnc(f,d).forEach((e=>fc_removeElement_fnc(e,300)))}return await new Promise((e=>{setTimeout((()=>{fc_toggle_controls_fnc(t,!1),e(!0)}),1e3)})),!0}default:return!1}}function fc_ensureMessengerStyles_fnc(){if(!fc_cfg||!fc_cfg.widget_id)return;if(document.getElementById(`fc-messenger-styles-${fc_cfg.widget_id}`))return;const e=document.createElement("style");e.id=`fc-messenger-styles-${fc_cfg.widget_id}`,e.textContent=`\n\n  .fc-chat-dock-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} {\n  will-change: transform, opacity;\n  contain: layout style paint;\n}\n\n    /* Window */\n    .fc-messenger-window-${fc_cfg.widget_id} {\n      position: fixed;\n      bottom: 80px;\n      right: 20px;\n      width: 320px;\n      height: 80vh;\n      max-width: 95vw;      \n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      border-radius: 10px;\n      box-shadow: 0 4px 16px color-mix(in srgb, ${fc_cfg.accent_color} 40%, black);\n      z-index: 9999;\n      background: ${fc_cfg.screen_bg_color};\n      color: ${fc_cfg.screen_text_color};\n      overflow: hidden;\n        opacity: 1;\n  transform: scale(1);\n  transition: height 0.4s ease, opacity 0.3s ease, transform 0.3s ease;\n    }\n\n  .fc-messenger-window-${fc_cfg.widget_id}.fc-hidden-${fc_cfg.widget_id} {\n  height: 0;              /* smoothly collapse */\n  opacity: 0;             /* fade out */\n  transform: scale(0.95); /* slight shrink */\n  pointer-events: none;   /* disable clicks */\n}\n\n .fc-messenger-window-${fc_cfg.widget_id} .fc-header-${fc_cfg.widget_id} {\n  background: ${fc_cfg.accent_color};\n  color: ${fc_cfg.accent_text_color};\n  padding: 10px;\n  font-weight: 600;\n}\n\n/* Online */\n.fc-messenger-window-${fc_cfg.widget_id} img.fc-online-${fc_cfg.widget_id}, \n.fc-dialog-overlay-${fc_cfg.widget_id} img.fc-online-${fc_cfg.widget_id}, \n.fc-chat-dock-${fc_cfg.widget_id} img.fc-online-${fc_cfg.widget_id} {\n  border: 2px solid #2ecc71;\n  box-sizing: border-box;\n  box-shadow: 0 0 4px rgba(46, 204, 113, 0.6);\n  transition: border-color 0.3s ease, box-shadow 0.3s ease;\n}\n\n/* Away */\n.fc-messenger-window-${fc_cfg.widget_id} img.fc-away-${fc_cfg.widget_id}, \n.fc-dialog-overlay-${fc_cfg.widget_id} img.fc-away-${fc_cfg.widget_id}, \n.fc-chat-dock-${fc_cfg.widget_id} img.fc-away-${fc_cfg.widget_id} {\n  border: 2px solid #f1c40f;\n  box-sizing: border-box;\n  box-shadow: 0 0 4px rgba(241, 196, 15, 0.6);\n  transition: border-color 0.3s ease, box-shadow 0.3s ease;\n}\n\n/* Busy */\n.fc-messenger-window-${fc_cfg.widget_id} img.fc-busy-${fc_cfg.widget_id}, \n.fc-dialog-overlay-${fc_cfg.widget_id} img.fc-busy-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} img.fc-busy-${fc_cfg.widget_id} {\n  border: 2px solid #e74c3c;\n  box-sizing: border-box;\n  box-shadow: 0 0 4px rgba(231, 76, 60, 0.6);\n  transition: border-color 0.3s ease, box-shadow 0.3s ease;\n}\n\n/* Offline */\n.fc-messenger-window-${fc_cfg.widget_id} img.fc-offline-${fc_cfg.widget_id}, \n.fc-dialog-overlay-${fc_cfg.widget_id} img.fc-offline-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} img.fc-offline-${fc_cfg.widget_id} {\n  border: 2px solid #95a5a6;\n  box-sizing: border-box;\n  box-shadow: 0 0 4px rgba(149, 165, 166, 0.6);\n  transition: border-color 0.3s ease, box-shadow 0.3s ease;\n}\n\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-statusColor-${fc_cfg.widget_id}.fc-online-${fc_cfg.widget_id},\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-statusColor-${fc_cfg.widget_id}.fc-online-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} .fc-statusColor-${fc_cfg.widget_id}.fc-online-${fc_cfg.widget_id} {\n  color: #2ecc71!important;\n}\n.fc-messenger-window-${fc_cfg.widget_id} .fc-statusColor-${fc_cfg.widget_id}.fc-away-${fc_cfg.widget_id}, \n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-statusColor-${fc_cfg.widget_id}.fc-away-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} .fc-statusColor-${fc_cfg.widget_id}.fc-away-${fc_cfg.widget_id} {\n  color: #f1c40f!important;\n}\n.fc-messenger-window-${fc_cfg.widget_id} .fc-statusColor-${fc_cfg.widget_id}.fc-busy-${fc_cfg.widget_id}, \n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-statusColor-${fc_cfg.widget_id}.fc-busy-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} .fc-statusColor-${fc_cfg.widget_id}.fc-busy-${fc_cfg.widget_id} {\n  color: #e74c3c!important;\n}\n.fc-messenger-window-${fc_cfg.widget_id} .fc-statusColor-${fc_cfg.widget_id}.fc-offline-${fc_cfg.widget_id}, \n.fc-dialog-overlay-${fc_cfg.widget_id}  .fc-statusColor-${fc_cfg.widget_id}.fc-offline-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} .fc-statusColor-${fc_cfg.widget_id}.fc-offline-${fc_cfg.widget_id} {\n  color: #95a5a6!important;\n}\n\n/* Base status dot */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-statusDot-${fc_cfg.widget_id},\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-statusDot-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} .fc-statusDot-${fc_cfg.widget_id} {\n  position: absolute;\n  top: 5px;\n  left: 5px;\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n  border: 1px solid ${fc_cfg.accent_color}; /* fallback */\n  border: 1px solid color-mix(in srgb, ${fc_cfg.accent_color} 40%, black); /* modern */\n  box-shadow: 0 0 2px rgba(0,0,0,0.3); /* subtle glow for visibility */\n}\n\n/* Online */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-statusDot-${fc_cfg.widget_id}.fc-online-${fc_cfg.widget_id},\n.fc-dialog-overlay-${fc_cfg.widget_id}  .fc-statusDot-${fc_cfg.widget_id}.fc-online-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} .fc-statusDot-${fc_cfg.widget_id}.fc-online-${fc_cfg.widget_id} {\n  background-color: #28a745; /* green */\n}\n\n/* Offline */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-statusDot-${fc_cfg.widget_id}.fc-offline-${fc_cfg.widget_id},\n.fc-dialog-overlay-${fc_cfg.widget_id}  .fc-statusDot-${fc_cfg.widget_id}.fc-offline-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} .fc-statusDot-${fc_cfg.widget_id}.fc-offline-${fc_cfg.widget_id} {\n  background-color: #6c757d; /* gray */\n}\n\n/* Busy */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-statusDot-${fc_cfg.widget_id}.fc-busy-${fc_cfg.widget_id},\n.fc-dialog-overlay-${fc_cfg.widget_id}  .fc-statusDot-${fc_cfg.widget_id}.fc-busy-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} .fc-statusDot-${fc_cfg.widget_id}.fc-busy-${fc_cfg.widget_id} {\n  background-color: #dc3545; /* red */\n}\n\n/* Away */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-statusDot-${fc_cfg.widget_id}.fc-away-${fc_cfg.widget_id},\n.fc-dialog-overlay-${fc_cfg.widget_id}  .fc-statusDot-${fc_cfg.widget_id}.fc-away-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} .fc-statusDot-${fc_cfg.widget_id}.fc-away-${fc_cfg.widget_id} {\n  background-color: #ffc107; /* yellow */\n}\n\n/* Messenger User Header */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 6px;\n  background: color-mix(in srgb, ${fc_cfg.accent_color} 40%, white);\n  border-bottom: 1px solid color-mix(in srgb, ${fc_cfg.accent_color} 40%, black);\n  box-shadow: 0 1px 3px color-mix(in srgb, ${fc_cfg.accent_color} 40%, black);\n  position: relative;\n}\n\n/* Avatar */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-dp-${fc_cfg.widget_id} {\n  width: 60px;\n  height: 60px;\n  border-radius: 50%;\n  object-fit: cover;\n  margin-right: 6px;\n}\n\n/* Edit icon overlay */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-edit-icon-${fc_cfg.widget_id} {\n  position: absolute;\n  top: 2px;\n  left: 45px;\n  width: 20px;\n  height: 20px;\n  background: ${fc_cfg.accent_color};\n  color: ${fc_cfg.accent_text_color};\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 12px;\n  cursor: pointer;\n  box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n}\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-edit-icon-${fc_cfg.widget_id}:hover {\n  background: ${fc_cfg.accent_text_color};\n  color: ${fc_cfg.accent_color};\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} p {\n  padding: 0;\n  margin: 0;\n}\n\n/* Title block */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-title-${fc_cfg.widget_id} {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-width: 0;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-nickname-${fc_cfg.widget_id} {\n  font-size: 0.95rem;\n  font-weight: 600;\n  color: color-mix(in srgb, ${fc_cfg.accent_text_color} 40%, black);\n  max-width: 20ch;       /* limit to ~22 characters */\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  margin: 1px;\n  padding: 1px;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-status-${fc_cfg.widget_id} {\n  font-size: 0.75rem;\n  color: color-mix(in srgb, ${fc_cfg.accent_text_color} 40%, black);\n  margin: 1px;\n  padding: 1px;\n}\n\n/* Icons area */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-icons-${fc_cfg.widget_id} {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  font-size: 16px;\n}\n\n/* Notification bell */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-icons-${fc_cfg.widget_id} .fc-lnk-${fc_cfg.widget_id} {\n  color: color-mix(in srgb, ${fc_cfg.accent_text_color} 40%, black);\n  cursor: pointer;\n  transition: transform 0.2s ease, color 0.2s ease;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-icons-${fc_cfg.widget_id} .fc-lnk-${fc_cfg.widget_id}:hover {\n  color: ${fc_cfg.accent_color};\n  transform: scale(1.2);\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-icons-${fc_cfg.widget_id} .fc-lnk-${fc_cfg.widget_id}.fc-unread-${fc_cfg.widget_id}{\n  color: ${fc_cfg.accent_color};\n}\n\n/* Notification menu */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-notifications-menu-${fc_cfg.widget_id} {\n  display: block;              /* keep block for transition */\n  visibility: hidden;\n  opacity: 0;\n  position: absolute;\n  right: 0;\n  margin-top: 3px;\n  background: ${fc_cfg.screen_bg_color};\n  border: 1px solid color-mix(in srgb, ${fc_cfg.accent_color} 40%, black);\n  border-radius: 4px;\n  box-shadow: 0 4px 12px color-mix(in srgb, ${fc_cfg.accent_color} 40%, black);\n  max-height: 50%;\n  max-width: 95%;\n  min-width: 260px;\n  min-height: 220px;\n  overflow-y: auto;\n  overscroll-behavior: contain;\n  scroll-behavior: smooth;\n  transform: translateZ(0);\n  overflow-x: hidden;\n  padding: 0;\n  z-index: 10000;\n  transition: opacity 0.3s ease, visibility 0s linear 0.3s; /* delay hide */\n}\n\n/* Show menu on hover */\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-notifications-${fc_cfg.widget_id} {\n position: relative;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-notifications-${fc_cfg.widget_id}:hover .fc-notifications-menu-${fc_cfg.widget_id} {\n  visibility: visible;\n  opacity: 1;\n  transition-delay: 0s; /* show immediately */\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-self-info-${fc_cfg.widget_id} .fc-notifications-${fc_cfg.widget_id} .fc-badge-${fc_cfg.widget_id} {\n  position: absolute;\n  top: 2px;\n  right: -3px;\n}\n\n/* Notification items */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-notifications-menu-${fc_cfg.widget_id} li {\n  padding: 8px 12px;\n  font-size: 0.85rem;\n  color: ${fc_cfg.screen_text_color};\n  transition: background-color 0.2s ease;\n  border-bottom: 1px dashed ${fc_cfg.accent_color};\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-notifications-menu-${fc_cfg.widget_id} li.fc-unread-${fc_cfg.widget_id} {\n  background-color: color-mix(in srgb, ${fc_cfg.accent_color} 40%, white);\n  color: color-mix(in srgb, ${fc_cfg.accent_text_color} 40%, black);\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-notifications-menu-${fc_cfg.widget_id} li:hover {\n  background-color: ${fc_cfg.accent_color};\n  color: ${fc_cfg.accent_text_color};\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-notifications-menu-${fc_cfg.widget_id} li a {\n  color: inherit;\n  text-decoration: none;\n  font-weight: bold;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-notifications-menu-${fc_cfg.widget_id} li a:hover {\n  text-decoration: underline;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tabs-${fc_cfg.widget_id} {\n  display: flex;\n  border-bottom: 1px solid ${fc_cfg.button_color}\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tab-${fc_cfg.widget_id} {\n  flex: 1;\n  text-align: center;\n  padding: 10px;\n  cursor: pointer;\n  color: ${fc_cfg.screen_text_color};\n  transition: all 0.3s ease;\n  position: relative;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tab-${fc_cfg.widget_id} .fc-badge-${fc_cfg.widget_id} {\n  position: absolute;\n  top: 6px;\n  right: 16px;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tab-${fc_cfg.widget_id}:focus-visible {\n  outline: 2px solid ${fc_cfg.accent_color};\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tab-${fc_cfg.widget_id}:hover {\n  color: ${fc_cfg.accent_color};\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tab-${fc_cfg.widget_id}.fc-active-${fc_cfg.widget_id} {\n  color: ${fc_cfg.accent_color};\n  font-weight: bold;\n  border-bottom: 1px solid ${fc_cfg.accent_color};\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tabsContents-${fc_cfg.widget_id} {\n  flex: 1;\n  overflow-y: auto;\n  overscroll-behavior: contain;\n  scroll-behavior: smooth;\n  transform: translateZ(0);\n  padding: 0px;\n  background: ${fc_cfg.screen_bg_color};\n  color: ${fc_cfg.screen_text_color};\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tabContent-${fc_cfg.widget_id} {\n  display: none;\n  padding: 0px;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tabContent-${fc_cfg.widget_id}.fc-active-${fc_cfg.widget_id} {\n  display: block;\n}\n\n/* ===== Shared List Containers ===== */\n.fc-messenger-window-${fc_cfg.widget_id} #fc-list-rooms-${fc_cfg.widget_id} ul,\n.fc-messenger-window-${fc_cfg.widget_id} #fc-list-nearby-${fc_cfg.widget_id} ul,\n.fc-messenger-window-${fc_cfg.widget_id} #fc-list-chats-${fc_cfg.widget_id} ul {\n  list-style: none;\n  margin: 0;\n  padding: 0;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tabContent-${fc_cfg.widget_id} .fc-searchWrap-${fc_cfg.widget_id} {\n  border-top: 1px solid color-mix(in srgb, ${fc_cfg.accent_color} 40%, black);\n  border-bottom: 1px solid color-mix(in srgb, ${fc_cfg.accent_color} 40%, black);\n  font-weight: 200;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tabContent-${fc_cfg.widget_id} .fc-searchWrap-${fc_cfg.widget_id} label {\n  position: absolute;\n  margin: 7px 0 0 14px;\n  color: ${fc_cfg.accent_color};\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-tabContent-${fc_cfg.widget_id} .fc-searchWrap-${fc_cfg.widget_id} .fc-search-${fc_cfg.widget_id} {\n  font-size: 0.9rem;\n  padding: 10px 0 10px 46px;\n  width: 100%;\n  border: none;\n  background: color-mix(in srgb, ${fc_cfg.accent_color} 40%, white);\n  color: ${fc_cfg.accent_color};\n}\n\n/* ===== Shared Item Styling (Rooms + Nearby + Chats) ===== */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} {\n  display: flex;\n  align-items: center;\n  padding: 5px 6px;\n  border-bottom: 1px solid ${fc_cfg.button_color};\n  cursor: pointer;\n  color: ${fc_cfg.recipient_text_color};\n  background-color: ${fc_cfg.recipient_bg_color};\n  transition: background-color 0.2s ease, color 0.2s ease;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id}:hover,\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id}:hover,\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id}:hover {\n  color: ${fc_cfg.sender_text_color};\n  background-color: ${fc_cfg.sender_bg_color};\n  cursor: default;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id}.fc-unread-${fc_cfg.widget_id} {\n  font-weight: 600;\n}\n\n\n/* Inner wrap */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id} .fc-wrap-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id} .fc-wrap-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} .fc-wrap-${fc_cfg.widget_id} {\n  display: flex;\n  align-items: center;\n  width: 100%;\n  position: relative; /* allows status dot overlay */\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id} .fc-wrap-${fc_cfg.widget_id}.fc-link-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id} .fc-wrap-${fc_cfg.widget_id}.fc-link-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} .fc-wrap-${fc_cfg.widget_id}.fc-link-${fc_cfg.widget_id} {\n  cursor: pointer;\n}\n\n/* ===== Avatar Images ===== */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id} img,\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id} img,\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} img {\n  width: 40px;\n  height: 40px;\n  border-radius: 6px; /* rooms: rounded square */\n  object-fit: cover;\n  margin-right: 10px;\n}\n\n/* Nearby avatars are circular */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id} img,\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} img {\n  border-radius: 50%;\n}\n\n/* ===== Status Dot Overlay (Chat + Nearby) ===== */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id} .fc-status-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} .fc-status-${fc_cfg.widget_id} {\n  position: absolute;\n  top: 2px;\n  left: 2px;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  border: 1px solid ${fc_cfg.recipient_bg_color}; /* separates dot from avatar */\n}\n\n/* ===== Meta Info ===== */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id} .fc-meta-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id} .fc-meta-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} .fc-meta-${fc_cfg.widget_id} {\n  flex: 1;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id} .fc-meta-${fc_cfg.widget_id} .fc-name-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id} .fc-meta-${fc_cfg.widget_id} .fc-name-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} .fc-meta-${fc_cfg.widget_id} .fc-name-${fc_cfg.widget_id} {\n  font-size: 14px;\n  margin: 0;\n  display: block;\n  max-width: 22ch;       /* limit to ~22 characters */\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id} .fc-meta-${fc_cfg.widget_id} .fc-preview-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id} .fc-meta-${fc_cfg.widget_id} .fc-preview-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} .fc-meta-${fc_cfg.widget_id} .fc-preview-${fc_cfg.widget_id} {\n  font-size: 10px;\n  margin: 2px 0 0;\n  opacity: 0.8;\n  max-width: 24ch; /* limit to ~24 characters */\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n/* ===== Action Area (icons) ===== */\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id},\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id} \n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id} {\n  margin-left: auto;\n  display: flex;\n  align-items: center;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id} a,\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id} svg,\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id} a,\n.fc-nearby-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id} svg,\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id} a,\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id} svg {\n  color: ${fc_cfg.recipient_text_color};\n  text-decoration: none;\n  transition: transform 0.2s ease, color 0.2s ease;\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-room-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id} a:hover svg,\n.fc-messenger-window-${fc_cfg.widget_id} .fc-nearby-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id} a:hover svg,\n.fc-messenger-window-${fc_cfg.widget_id} .fc-chat-${fc_cfg.widget_id} .fc-action-${fc_cfg.widget_id} a:hover svg {\n  transform: scale(1.1);\n  color: ${fc_cfg.sender_text_color};\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-badge-${fc_cfg.widget_id} {\n  color: color-mix(in srgb, ${fc_cfg.accent_text_color} 40%, white);\n  background-color: color-mix(in srgb, ${fc_cfg.accent_color} 40%, black);\n  font-size: 0.55rem;\n  min-width: 15px;\n  height: 15px;\n  line-height: 15px;\n  border-radius: 50%;\n  text-align: center;\n  padding: 0 3px;\n  display: inline-block;\n  margin-left: auto; /* push to right */\n}\n\n\n/* Dock container fixed at bottom */\n#fc-chat-dock-${fc_cfg.widget_id} {\n  position: fixed;\n  bottom: 0;\n  left: 24px;\n  right: 350px; /* leave space for "More" button */\n  height: auto;\n  z-index: 9999;\n  display: flex;\n  align-items: flex-end;\n  gap: 6px;\n  padding: 0;\n  pointer-events: none; /* allow windows to manage interactions */\n}\n\n\n/* Each chat window */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-win-${fc_cfg.widget_id} {\n  pointer-events: auto;\n  width: 280px;\n  max-height: 50vh;\n  min-height: 325px;\n  background: ${fc_cfg.screen_bg_color};\n  border: 1px solid color-mix(in srgb, ${fc_cfg.screen_bg_color} 80%, black);\n  border-radius: 10px 10px 0 0;\n  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);\n  display: flex;\n  flex-direction: column;\n  position: relative;\n  overflow: hidden;\n  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;\n}\n\n/* Header container with enhanced gradient */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-info-${fc_cfg.widget_id} {\n  display: flex;\n  align-items: center;                 /* vertical center avatar + title + icons */\n  justify-content: space-between;\n  gap: 5px;\n  padding: 8px 12px;\n  color: ${fc_cfg.screen_text_color};\n  user-select: none;\n\n  /* Smooth vertical gradient with subtle lighting effect */\n  background: linear-gradient(\n    to bottom,\n    rgba(0, 0, 0, 0.5) 0%,                  /* dark top */\n    ${fc_cfg.screen_bg_color} 50%,          /* center color */\n    rgba(255, 255, 255, 0.5) 100%          /* light bottom */\n  );\n\n  border-bottom: 1px solid rgba(0, 0, 0, 0.3);\n  border-radius: 10px 10px 0 0;\n\n  /* Subtle text shadow for better readability */\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n\n  /* Smooth hover effect (optional) */\n  transition: background 0.3s ease, color 0.3s ease;\n}\n\n/* Header hover effect (optional, adds modern feel) */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-info-${fc_cfg.widget_id}:hover {\n  background: linear-gradient(\n    to bottom,\n    rgba(0, 0, 0, 0.9) 0%,\n    ${fc_cfg.screen_bg_color} 50%,\n    rgba(255, 255, 255, 0.9) 100%\n  );\n  color: ${fc_cfg.screen_text_color};\n}\n\n\n\n/* Avatar */\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-dp-${fc_cfg.widget_id}, \n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-info-${fc_cfg.widget_id} .fc-dp-${fc_cfg.widget_id} {\n  width: 28px;\n  height: 28px;\n  border-radius: 50%;\n  object-fit: cover;\n}\n\n/* Title block (nickname + status) */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-title-${fc_cfg.widget_id} {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;            /* vertical center text inside */\n  align-items: flex-start;            /* left align */\n  line-height: 1.2;\n  flex: 1;                            /* take available width between avatar & icons */\n  min-width: 0;                       /* allow flexbox to shrink text properly */\n  height: 32px;                       /* controlled height */\n  max-height: 32px;\n}\n\n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-title-${fc_cfg.widget_id} p {\n  margin: 0;\n  padding: 0;\n}\n\n/* Nickname */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-title-${fc_cfg.widget_id} .fc-nickname-${fc_cfg.widget_id} {\n  font-weight: 600;\n  font-size: 12px;\n  margin: 0;\n  max-width: 18ch;       /* limit to ~22 characters */\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  padding-bottom: 1px;\n}\n\n/* Status */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-title-${fc_cfg.widget_id} .fc-status-${fc_cfg.widget_id} {\n  font-size: 10px;\n  color: color-mix(in srgb, ${fc_cfg.screen_text_color} 40%, black);\n   max-width: 22ch;       /* limit to ~22 characters */\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  padding-top: 1px;\n}\n\n/* Header controls (buttons) */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-icons-${fc_cfg.widget_id} {\n  display: flex;\n  align-items: center;\n  gap: 1px;\n}\n\n.fc-chat-dock-${fc_cfg.widget_id} .fc-icon-btn-${fc_cfg.widget_id} {\n  border: none;\n  background: transparent;\n  cursor: pointer;\n  color: ${fc_cfg.button_color};\n  padding: 2px;\n  border-radius: 6px;\n  transition: background .2s, color .2s;\n}\n\n.fc-chat-dock-${fc_cfg.widget_id} .fc-icon-btn-${fc_cfg.widget_id}:hover {\n  background: ${fc_cfg.button_color};\n  color: ${fc_cfg.button_text_color};\n}\n\n\n/* Messages */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} {\n  overflow-y: scroll;\n  overflow-x: hidden;\n  overscroll-behavior: contain;\n  scroll-behavior: smooth;\n  transform: translateZ(0);\n  padding: 0px;\n  min-height: 243px;\n}\n\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id}::-webkit-scrollbar {\n  width: 8px;\n  background: transparent;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id}::-webkit-scrollbar-thumb {\n  background-color: rgba(0, 0, 0, 0.3);\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul {\nmargin: 0px;\npadding:1px 0px 10px 2px;\n\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li {\n  display: inline-block;\n  clear: both;\n  margin: 5px;\n  width: calc(100% - 20px);\n  font-size: 0.7em;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li:nth-last-child(1) {\n  margin-bottom: 10px;\n}\n\n.fc-system-${fc_cfg.widget_id} {\n  text-align: center;\n  list-style: none;\n}\n\n.fc-system-text-${fc_cfg.widget_id} {\n  display: inline-block;\n  background: ${fc_cfg.screen_text_color};\n  color: ${fc_cfg.screen_bg_color};\n  font-style: italic;\n}\n\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li.fc-replies-${fc_cfg.widget_id} img.fc-dp-${fc_cfg.widget_id} {\n  float: left;\n  margin: 3px 7px 0px 0px;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li.fc-replies-${fc_cfg.widget_id} span.fc-nickname-${fc_cfg.widget_id} {\n  text-align: left !important;\n  font-size: 0.6rem;\n  font-weight: 600;\n  padding: 4px 5px 5px 30px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li.fc-replies-${fc_cfg.widget_id} p {\n  background: ${fc_cfg.recipient_bg_color};\n  color: ${fc_cfg.recipient_text_color};\n  float: left;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li.fc-replies-${fc_cfg.widget_id} span.fc-status-${fc_cfg.widget_id} {\n  text-align: left !important;\n  font-size: 0.5rem;\n  color: ${fc_cfg.recipient_bg_color};\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li.fc-sent-${fc_cfg.widget_id} img.fc-dp-${fc_cfg.widget_id} {\n  float: right;\n  margin: 3px 0 0px 7px;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li.fc-sent-${fc_cfg.widget_id} span.fc-nickname-${fc_cfg.widget_id} {\n  text-align: right !important;\n  font-size: 0.6rem;\n  font-weight: 600;\n  padding: 4px 30px 5px 5px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li.fc-sent-${fc_cfg.widget_id} p {\n  background: ${fc_cfg.sender_bg_color};\n  color: ${fc_cfg.sender_text_color};\n  float: right;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li.fc-sent-${fc_cfg.widget_id} span.fc-status-${fc_cfg.widget_id} {\n  display: flex;\n  flex-direction: row;\n  align-items: right;\n  justify-content: right;\n  font-size: 0.5rem;\n  color: ${fc_cfg.sender_bg_color};\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li img.fc-dp-${fc_cfg.widget_id} {\n  width: 22px;\n  border-radius: 50%;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li span.fc-nickname-${fc_cfg.widget_id} {\n  display: block;\n  padding: 5px 10px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  text-shadow: 0 1px 2px ${fc_cfg.screen_text_color};\n  -webkit-text-stroke: 0.5px ${fc_cfg.screen_text_color};\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li p {\n  padding: 5px 5px;\n  border-radius: 10px;\n  max-width: 77%;\n  line-height: 130%;\n  margin-bottom: 0.1rem;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li p img{\n  max-width: 180px;\n  max-height: 180px;\n  border-radius: 10px;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li span.fc-status-${fc_cfg.widget_id} {\n  display: inline;\n  padding: 5px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.fc-chat-dock-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id} ul li span.fc-status-${fc_cfg.widget_id}.fc-seen-${fc_cfg.widget_id} {\n  color: ${fc_cfg.sender_bg_color};\n  -webkit-text-stroke: 1px ${fc_cfg.sender_text_color};\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n\n/* Input area */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} {\n  border-top: 1px solid color-mix(in srgb, ${fc_cfg.screen_bg_color} 80%, black);\n  padding: 1px;\n  background: ${fc_cfg.button_color};\n}\n\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} .fc-wrap-${fc_cfg.widget_id} {\n  display: flex;\n  align-items: center;\n}\n\n\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} .fc-wrap-${fc_cfg.widget_id} .fc-file-form-${fc_cfg.widget_id} {\n  visibility: hidden;\n  position: absolute;\n}\n\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} input[type="text"] {\n  flex: 1;\n  padding: 7px;\n  font-size: 12px;\n  background: ${fc_cfg.button_color};\n  border: 0;\n  color: ${fc_cfg.button_text_color};  \n  transition: border-color .2s, box-shadow .2s, color .2s;\n}\n\n/* Placeholder (hint text) */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} input[type="text"]::placeholder {\n  color: color-mix(in srgb, ${fc_cfg.button_text_color} 60%, black); /* softer hint color */\n  opacity: 1; /* ensure consistent rendering across browsers */\n}\n\n/* When focused (typing) */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} input[type="text"]:focus {\n  outline: none; \n  background: ${fc_cfg.button_text_color};\n  border: 1px solid color-mix(in srgb, ${fc_cfg.button_color} 80%, black);\n  border-color: ${fc_cfg.button_color}; \n  box-shadow: 0 0 4px ${fc_cfg.button_color}; \n  color: ${fc_cfg.button_color}; \n}\n\n/* Placeholder when focused */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} input[type="text"]:focus::placeholder {\n  color: color-mix(in srgb, ${fc_cfg.button_color} 60%, white); /* adjust hint color on focus */\n}\n\n/* Attachment/submit buttons */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} .fc-attachment-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} .fc-submit-${fc_cfg.widget_id} {\n  border: none;\n  background: ${fc_cfg.button_color};\n  padding: 5px;\n  cursor: pointer;\n  color: ${fc_cfg.button_text_color};\n  transition: background .2s, color .2s, box-shadow .2s;\n}\n\n/* Hover and focus states */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} .fc-attachment-${fc_cfg.widget_id}:hover,\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} .fc-attachment-${fc_cfg.widget_id}:focus,\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} .fc-submit-${fc_cfg.widget_id}:hover,\n.fc-chat-dock-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} .fc-submit-${fc_cfg.widget_id}:focus {\n  background: ${fc_cfg.button_text_color};   /* invert background */\n  color: ${fc_cfg.button_color};             /* invert text color */\n  outline: none;                             /* remove default outline */\n  box-shadow: 0 0 4px ${fc_cfg.button_color};/* subtle glow for focus */\n}\n\n\n/* Minimized state */\n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-win-${fc_cfg.widget_id}.fc-minimized-${fc_cfg.widget_id} .fc-messages-${fc_cfg.widget_id},\n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-win-${fc_cfg.widget_id}.fc-minimized-${fc_cfg.widget_id} .fc-inputs-${fc_cfg.widget_id} {\n  display: none;\n}\n\n.fc-chat-dock-${fc_cfg.widget_id} .fc-chat-win-${fc_cfg.widget_id}.fc-minimized-${fc_cfg.widget_id} {\n  width: 220px;\n  min-height: 0!important;\n}\n\n/* Blink on new message */\n@keyframes fc-blink-${fc_cfg.widget_id} {\n  0%   { background-color: ${fc_cfg.accent_color}; box-shadow: 0 0 4px ${fc_cfg.accent_color}; }\n  50%  { background-color: ${fc_cfg.accent_text_color}; box-shadow: 0 0 12px ${fc_cfg.accent_text_color}; }\n  100% { background-color: ${fc_cfg.accent_color}; box-shadow: 0 0 4px ${fc_cfg.accent_color}; }\n}\n\n.fc-chat-dock-${fc_cfg.widget_id} .fc-blink-${fc_cfg.widget_id} {\n  animation: fc-blink-${fc_cfg.widget_id} 1s ease-in-out infinite;\n}\n\n/* Hidden windows indicator (for internal management) */\n.fc-hidden-${fc_cfg.widget_id} {\n  display: none !important;\n}\n\n.fc-lightbox-thumb-${fc_cfg.widget_id} {\n  max-width: 160px;\n  border-radius: 6px;\n  cursor: zoom-in;\n  transition: transform .15s ease;\n}\n\n.fc-lightbox-thumb-${fc_cfg.widget_id}:hover {\n  transform: scale(1.04);\n}\n\n.fc-lightbox-overlay-${fc_cfg.widget_id} {\n  position: fixed;\n  inset: 0;\n  top: 0; right: 0; bottom: 0; left: 0;\n  background: rgba(0,0,0,.92);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999999;\n  cursor: zoom-out;\n}\n\n.fc-lightbox-overlay-${fc_cfg.widget_id} img {\n  max-width: 95%;\n  max-height: 95%;\n  object-fit: contain;\n  border-radius: 6px;\n}\n\n/* Overlay */\n.fc-dialog-overlay-${fc_cfg.widget_id} {\n  position: fixed;\n  top: 0; left: 0;\n  width: 100%; height: 100%;\n  background: rgba(0,0,0,0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n}\n\n/* Dialog box */\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-dialog-box-${fc_cfg.widget_id} {\n  background: #fff;\n  border-radius: 6px;\n  min-width: 300px;\n  max-width: 600px;\n  max-height: 80vh;              /* limit height */\n  display: flex;\n  flex-direction: column;        /* stack header + body */\n  padding: 1rem;\n  box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n  animation: fc-fadeIn-${fc_cfg.widget_id} 0.3s ease;\n}\n\n/* Header */\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-dialog-header-${fc_cfg.widget_id} {\n  font-weight: bold;\n  font-size: 1rem;\n  margin-bottom: 0.5rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n/* Body (scrollable) */\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-dialog-body-${fc_cfg.widget_id} {\n  font-size: 0.75rem;\n  color: #333;\n  overflow-y: auto;              /* scrollable */\n  flex: 1;                       /* fill remaining space */\n  padding-right: 0.5rem;         /* avoid scrollbar overlap */\n}\n\n/* Close button */\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-dialog-close-${fc_cfg.widget_id} {\n  background: none;\n  border: none;\n  font-size: 1.2rem;\n  cursor: pointer;\n}\n\n/* Animation */\n@keyframes fc-fadeIn-${fc_cfg.widget_id} {\n  from { opacity: 0; transform: scale(0.95); }\n  to   { opacity: 1; transform: scale(1); }\n}\n\n/* Profile container */\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-profile-container-${fc_cfg.widget_id} {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 1rem;\n  max-width: 700px;\n  margin: 0 auto;\n  padding: 0.5rem;\n  box-sizing: border-box;\n  background: linear-gradient(135deg, #fdfdfd, #f7f9fc);\n  border-radius: 12px;\n  box-shadow: 0 5px 15px rgba(0,0,0,0.12);\n}\n\n/* Left column (avatar + status) */\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-profile-left-${fc_cfg.widget_id} {\n  flex: 1 1 30%;\n  text-align: center;\n}\n\n.fc-input-${fc_cfg.widget_id},\n.fc-select-${fc_cfg.widget_id} {\n  padding: 0.4rem 0.6rem;\n  border: 1px solid #ccc;\n  border-radius: 6px;\n  font-size: 0.75rem;\n  color: #222;\n  background: #fff;\n  transition: border-color 0.2s ease;\n}\n\n.fc-input-${fc_cfg.widget_id}:focus,\n.fc-select-${fc_cfg.widget_id}:focus {\n  border-color: #652fda;\n  outline: none;\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-avatar-wrap-${fc_cfg.widget_id} {\n  position: relative;\n  display: inline-block;\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-avatar-wrap-${fc_cfg.widget_id} img {\n  max-width: 100px;\n  border-radius: 50%;\n  transition: transform 0.3s ease;\n  margin-bottom: 10px;\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-avatar-wrap-${fc_cfg.widget_id} img:hover {\n  transform: scale(1.05);\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-statusText-${fc_cfg.widget_id} {\n  margin-top: 0.75rem;\n  font-weight: 600;\n  font-size: 1rem;\n}\n\n/* Right column (details) */\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-profile-right-${fc_cfg.widget_id} {\n  flex: 1 1 65%;\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-profile-row-${fc_cfg.widget_id} {\n  display: flex;\n  justify-content: space-between;\n  margin: 0.2rem 0;\n  padding: 0.2rem 0;\n  border-bottom: 1px dashed #e0e0e0;\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-profile-label-${fc_cfg.widget_id} {\n  font-weight: 600;\n  color: #555;\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-profile-label-${fc_cfg.widget_id} .fc-name-${fc_cfg.widget_id} {\n    max-width: 9ch;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-profile-value-${fc_cfg.widget_id} {\n  color: #222;\n  font-weight: 500;\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-profile-value-${fc_cfg.widget_id}.fc-admin-${fc_cfg.widget_id} {\n  color: #02a800;\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-profile-value-${fc_cfg.widget_id}.fc-block-${fc_cfg.widget_id} {\n  color: #ff0000;\n}\n\n/* Special section */\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-profile-row-${fc_cfg.widget_id}.fc-looking-${fc_cfg.widget_id} {\n  margin-top: 1.25rem;\n  font-style: italic;\n  font-weight: bold;\n  color: #260079;\n  border-bottom: none;\n}\n\n/* Action section */\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-profile-action-${fc_cfg.widget_id} {\n  flex: 1 1 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-top: 1.5rem;\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-accept-btn-${fc_cfg.widget_id} {\n  padding: 0.75rem 1.5rem;\n  font-size: 1rem;\n  font-weight: 600;\n  color: #fff;\n  background: linear-gradient(135deg, #652fdaff, #260079);\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-accept-btn-${fc_cfg.widget_id}:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 12px rgba(0,0,0,0.15);\n}\n\n.fc-dialog-overlay-${fc_cfg.widget_id} .fc-accept-btn-${fc_cfg.widget_id}:active {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 12px rgba(0,0,0,0.15);\n}\n\n\n/* Responsive adjustments */\n@media (max-width: 480px) {\n  .fc-profile-container-${fc_cfg.widget_id} {\n    flex-direction: column;\n    padding: 1rem;\n  }\n  .fc-profile-left-${fc_cfg.widget_id}, .fc-profile-right-${fc_cfg.widget_id} {\n    flex: 1 1 100%;\n  }\n}\n\n.fc-messenger-window-${fc_cfg.widget_id} .fc-footer-${fc_cfg.widget_id} {\n      font-size: 12px;\n      padding: 8px;\n      text-align: center;\n      background: #9667C7;\n      color: #260079;\n    }\n.fc-messenger-window-${fc_cfg.widget_id} .fc-footer-${fc_cfg.widget_id} a {\n      color: inherit;\n      text-decoration: none;\n    }\n\n@media (prefers-reduced-motion: reduce) {\n  * {\n    animation: none !important;\n    transition: none !important;\n  }\n}\n\n\n  `,document.head.appendChild(e)}class IndexedDBWrapper{constructor(e="fishingcab",c="data"){this.dbName=e,this.storeName=c,this.db=null,this.listeners=[]}async init(){return new Promise(((e,c)=>{const n=indexedDB.open(this.dbName,5);n.onupgradeneeded=e=>{const c=e.target.result;c.objectStoreNames.contains("data")||c.createObjectStore("data",{keyPath:"id",autoIncrement:!0}),c.objectStoreNames.contains("rooms")||c.createObjectStore("rooms",{keyPath:"id"}),c.objectStoreNames.contains("users")||c.createObjectStore("users",{keyPath:"id"}),c.objectStoreNames.contains("chats")||c.createObjectStore("chats",{keyPath:"id"}),c.objectStoreNames.contains("messages")||c.createObjectStore("messages",{keyPath:"id"}),c.objectStoreNames.contains("push")||c.createObjectStore("push",{keyPath:"id"}),c.objectStoreNames.contains("notifications")||c.createObjectStore("notifications",{keyPath:"id"}),c.objectStoreNames.contains("tmp")||c.createObjectStore("tmp",{keyPath:"id"})},n.onsuccess=c=>{this.db=c.target.result,e(this.db)},n.onerror=e=>c(e.target.error)}))}onChange(e){this.listeners.push(e)}async notifyChange(){const e=await this.getAll();this.listeners.forEach((c=>c(e)))}async save(e){return new Promise(((c,n)=>{const t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(e);t.onsuccess=async()=>{await this.notifyChange(),c(t.result)},t.onerror=e=>n(e.target.error)}))}async get(e){return new Promise(((c,n)=>{const t=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);t.onsuccess=()=>c(t.result||null),t.onerror=e=>n(e.target.error)}))}async findByField(e,c){return new Promise(((n,t)=>{const i=this.db.transaction(this.storeName,"readonly"),f=i.objectStore(this.storeName);let o=null;f.openCursor().onsuccess=t=>{const i=t.target.result;if(i){if(i.value[e]===c)return o=i.value,void n(o);i.continue()}else n(o)},i.onerror=e=>t(e.target.error)}))}async getAll(){return new Promise(((e,c)=>{const n=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).getAll();n.onsuccess=()=>e(n.result||[]),n.onerror=e=>c(e.target.error)}))}async delete(e){return new Promise(((c,n)=>{const t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);t.onsuccess=async()=>{await this.notifyChange(),c(!0)},t.onerror=e=>n(e.target.error)}))}async deleteByField(e,c){return new Promise(((n,t)=>{const i=this.db.transaction(this.storeName,"readwrite"),f=i.objectStore(this.storeName);let o=!1;f.openCursor().onsuccess=t=>{const i=t.target.result;i?(i.value[e]===c&&(f.delete(i.primaryKey),o=!0),i.continue()):n(o)},i.onerror=e=>t(e.target.error)}))}async clear(){return new Promise(((e,c)=>{const n=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).clear();n.onsuccess=()=>e(!0),n.onerror=e=>c(e.target.error)}))}}function fc_showMessenger_fnc(e,c,n){if(window.fc_cfg=e,fc_cfg=window.fc_cfg,!fc_cfg||!fc_cfg.widget_id)return;fc_ensureMessengerStyles_fnc();const t=document.getElementById(`fc-messenger-window-${fc_cfg.widget_id}`);if(!t)return;t.textContent="";const i=fc_fragment_fnc();i.appendChild(fc_el_fnc("div",`fc-header-${fc_cfg.widget_id}`,{text:fc_safeText_fnc(fc_cfg.title)}));const f=fc_el_fnc("div",`fc-self-info-${fc_cfg.widget_id}`,{id:`fc-self-info-${c}`});f.appendChild(fc_el_fnc("img",`fc-dp-${fc_cfg.widget_id} fc-away-${fc_cfg.widget_id}`,{src:"",alt:""}));const o=fc_el_fnc("span",`fc-edit-icon-${fc_cfg.widget_id}`,{text:""});o.title="Edit profile",o.addEventListener("click",(()=>{fc_edit_profile_fnc(c,n)})),f.appendChild(o);const d=fc_el_fnc("div",`fc-title-${fc_cfg.widget_id}`);d.appendChild(fc_el_fnc("p",`fc-nickname-${fc_cfg.widget_id} fc-statusColor-${fc_cfg.widget_id} fc-away-${fc_cfg.widget_id}`)),d.appendChild(fc_el_fnc("p",`fc-status-${fc_cfg.widget_id}`)),f.appendChild(d);const s=fc_el_fnc("div",`fc-icons-${fc_cfg.widget_id}`),_=fc_el_fnc("div",`fc-location-${fc_cfg.widget_id}`),r=fc_el_fnc("a",`fc-lnk-${fc_cfg.widget_id}`,{href:"#",title:"Location","aria-label":"Location"});r.innerHTML='\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">\n  <path fill-rule="evenodd" d="M8 0a5 5 0 0 0-5 5c0 3.75 5 11 5 11s5-7.25 5-11a5 5 0 0 0-5-5zm0 7a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"/>\n</svg>\n',r.addEventListener("click",(async e=>{e.preventDefault();fc_alert_fnc("Please Wait...","info"),navigator.geolocation&&"function"==typeof navigator.geolocation.getCurrentPosition?navigator.geolocation.getCurrentPosition((async e=>{window.fc_lat=e.coords.latitude,window.fc_lon=e.coords.longitude;const t={latitude:String(e.coords.latitude),longitude:String(e.coords.longitude),offset:fc_offset},i=`fc_location_lock_${fc_cfg.widget_id}`;if(!window[i]){window[i]=!0;try{await fc_realTime_fnc("location_update",c,n,fc_user_id,t,(e=>{e&&fc_alert_fnc("Location updated","success")}))}catch{fc_alert_fnc("Location update failed","danger")}finally{setTimeout((()=>{window[i]=!1}),9e3)}}}),(e=>{let c="Location access denied or unavailable";if(e&&"number"==typeof e.code)switch(e.code){case 1:c="Location access denied by user";break;case 2:c="Location unavailable";break;case 3:c="Location request timed out"}fc_alert_fnc(c,"warning")}),{enableHighAccuracy:!0,timeout:8e3,maximumAge:0}):fc_alert_fnc("Geolocation not supported","danger")})),_.appendChild(r),s.appendChild(_);const a=fc_el_fnc("div",`fc-sound-${fc_cfg.widget_id}`),g=fc_el_fnc("a",`fc-lnk-${fc_cfg.widget_id}`,{href:"#",title:"Sound","aria-label":"Sound"});let l=fc_getCookie_fnc("fc_sound")||"unmuted";function w(e){"muted"===e?(window.fc_sound_muted=!0,g.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">\n  <path d="M3 9v6h4l5 5V4L7 9H3z"/>\n</svg>',g.title="Unmute"):(window.fc_sound_muted=!1,g.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">\n  <path d="M3 9v6h4l5 5V4L7 9H3zm14.5 3a4.5 4.5 0 0 0-1.5-3.5l-1 1a3.5 3.5 0 0 1 0 5l1 1a4.5 4.5 0 0 0 1.5-3.5zM18 8l-2 2m0 4 2 2"/>\n</svg>',g.title="Mute")}g.addEventListener("click",(e=>{e.preventDefault(),l="muted"===l?"unmuted":"muted",fc_setCookie_fnc("fc_sound",l),w(l)})),w(l),a.appendChild(g),s.appendChild(a);const u=fc_el_fnc("div",`fc-notifications-${fc_cfg.widget_id}`),p=fc_el_fnc("span","",{id:`fc-notifications-badge-${fc_cfg.widget_id}`,text:""}),m=fc_el_fnc("a",`fc-lnk-${fc_cfg.widget_id}`,{id:`fc-notifications-icon-${fc_cfg.widget_id}`,href:"#",title:"Notifications","aria-label":"Notifications"});m.innerHTML='\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="16" height="16" fill="currentColor" aria-hidden="true" role="img">\n    <path d="M224 0c-17.7 0-32 14.3-32 32V51.2C119 66 64 130.6 64 208v18.8c0 47-17.3 92.4-48.5 127.6l-7.4 8.3c-8.4 9.4-10.4 22.9-5.3 34.4S19.4 416 32 416H416c12.6 0 24-7.4 29.2-18.9s3.1-25-5.3-34.4l-7.4-8.3C401.3 319.2 384 273.9 384 226.8V208c0-77.4-55-142-128-156.8V32c0-17.7-14.3-32-32-32zm45.3 493.3c12-12 18.7-28.3 18.7-45.3H224 160c0 17 6.7 33.3 18.7 45.3s28.3 18.7 45.3 18.7s33.3-6.7 45.3-18.7z"/>\n  </svg>\n',u.append(p,m);const h=fc_el_fnc("ul",`fc-notifications-menu-${fc_cfg.widget_id}`,{id:`fc-notifications-${fc_cfg.widget_id}`});u.appendChild(h),s.appendChild(u);const $=fc_el_fnc("div",`fc-logout-${fc_cfg.widget_id}`),b=fc_el_fnc("a",`fc-lnk-${fc_cfg.widget_id}`,{href:"#",title:"Logout","aria-label":"Logout"});b.innerHTML='\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="16" height="16" fill="currentColor" aria-hidden="true" role="img">\n    <path d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"/>\n  </svg>\n',b.addEventListener("click",(e=>{e.preventDefault();const c=document.getElementById(`fc-chat-btn-${fc_cfg.widget_id}`),n=document.getElementById(`fc-messenger-window-${fc_cfg.widget_id}`);fc_removeElement_fnc(n,300),fc_removeElement_fnc(c,600),fc_deleteCookie_fnc("fc_user_public_key"),fc_deleteCookie_fnc("fc_user_secret_key"),fc_setCookie_fnc("fc_user_public_key",""),fc_setCookie_fnc("fc_user_secret_key","")})),$.appendChild(b),s.appendChild($),f.appendChild(s),i.appendChild(f);const x=fc_el_fnc("div",`fc-tabs-${fc_cfg.widget_id}`);x.setAttribute("role","tablist"),x.setAttribute("aria-label","Messenger tabs"),["chats","nearby","rooms"].forEach(((e,c)=>{const n=fc_el_fnc("div",`fc-tab-${fc_cfg.widget_id}${0===c?` fc-active-${fc_cfg.widget_id}`:""}`,{text:e.charAt(0).toUpperCase()+e.slice(1),"data-tab":e,id:`fc-${e}Tab-${fc_cfg.widget_id}`,role:"tab",tabindex:0,"aria-selected":0===c?"true":"false"});if("chats"===e){const e=fc_el_fnc("span","",{id:`fc-chats-badge-${fc_cfg.widget_id}`,text:""});n.appendChild(e)}x.appendChild(n)})),i.appendChild(x);const v=fc_el_fnc("div",`fc-tabsContents-${fc_cfg.widget_id}`,{id:`fc-tabsContents-${fc_cfg.widget_id}`});["chats","nearby","rooms"].forEach(((e,c)=>{const n=fc_el_fnc("div",`fc-tabContent-${fc_cfg.widget_id}${0===c?` fc-active-${fc_cfg.widget_id}`:""}`,{id:`fc-list-${e}-${fc_cfg.widget_id}`,role:"tabpanel","aria-labelledby":`fc-${e}Tab-${fc_cfg.widget_id}`});if("chats"===e){const e=fc_el_fnc("div",`fc-searchWrap-${fc_cfg.widget_id}`),c=fc_el_fnc("label","");c.innerHTML='\n    <svg width="16" height="16" viewBox="0 0 24 24"\n         xmlns="http://www.w3.org/2000/svg" fill="none">\n      <circle cx="11" cy="11" r="7"\n              stroke="currentColor" stroke-width="2"/>\n      <line x1="16.65" y1="16.65" x2="22" y2="22"\n            stroke="currentColor" stroke-width="2"\n            stroke-linecap="round"/>\n    </svg>\n  ';const t=fc_el_fnc("input",`fc-search-${fc_cfg.widget_id}`,{id:`fc-search-${fc_cfg.widget_id}`,type:"text",placeholder:"Search chats..."});let i;e.append(c,t),n.appendChild(e),t.addEventListener("input",(e=>{clearTimeout(i),i=setTimeout((()=>{const c=e.target.value.trim().toLowerCase(),n=document.getElementById(`fc-chats-${fc_cfg.widget_id}`);n&&n.querySelectorAll("li").forEach((e=>{e.style.display=e.textContent.toLowerCase().includes(c)?"":"none"}))}),150)}))}n.appendChild(fc_el_fnc("ul","",{id:`fc-${e}-${fc_cfg.widget_id}`})),v.appendChild(n)})),i.appendChild(v);const y=fc_el_fnc("div",`fc-footer-${fc_cfg.widget_id}`),k=fc_el_fnc("a","",{href:"https://fishingcab.com",target:"_blank",rel:"noopener noreferrer",text:"FishingCab.com"});y.appendChild(fc_el_fnc("span","",{text:"Powered by "})),y.appendChild(k),i.appendChild(y),t.appendChild(i);const C=fc_qsa_fnc(`.fc-tab-${fc_cfg.widget_id}`,t);C.forEach((e=>{const t=()=>{C.forEach((e=>{e.classList.remove(`fc-active-${fc_cfg.widget_id}`),e.setAttribute("aria-selected","false")})),e.classList.add(`fc-active-${fc_cfg.widget_id}`),e.setAttribute("aria-selected","true"),"function"==typeof fc_loadTab_fnc&&fc_loadTab_fnc(e.dataset.tab,c,n)};e.addEventListener("click",t),e.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||t()}))}))}function fc_token_fnc(e,c="aA#"){const n={a:"abcdefghijklmnopqrstuvwxyz",A:"ABCDEFGHIJKLMNOPQRSTUVWXYZ","#":"0123456789","!":"~`!@#$%^&*()_+-={}[]:\";'<>?,./|\\"};let t="";for(let e=0;e<c.length;e++){const i=n[c[e]];i&&(t+=i)}n[c]&&(t=n[c]);let i="";const f=t.length;for(let c=0;c<e;c++)i+=t[Math.floor(Math.random()*f)];return i}function fc_resetBackoff_fnc(){window.fc_streamBackoff=1e3}function fc_increaseBackoff_fnc(){window.fc_streamBackoff=Math.min(2*window.fc_streamBackoff,window.fc_streamBackoffMax)}function fc_safeCloseWS_fnc(){try{window.fc_ws&&(window.fc_ws.onopen=window.fc_ws.onmessage=window.fc_ws.onerror=window.fc_ws.onclose=null,window.fc_ws.close())}catch(e){}window.fc_ws=null,window.fc_wsActive=!1,window.fc_wsConnecting=!1,window.fc_heartbeatTimer&&(clearInterval(window.fc_heartbeatTimer),window.fc_heartbeatTimer=null)}function fc_openWS_fnc(e,c){if(window.fc_wsActive||window.fc_wsConnecting)return;window.fc_wsConnecting=!0,fc_safeCloseWS_fnc();const n=new WebSocket("wss://ws.fishingcab.com");window.fc_ws=n;n.onopen=()=>{window.fc_wsActive=!0,window.fc_wsConnecting=!1,fc_resetBackoff_fnc(),n.send(JSON.stringify({user_id:fc_user_id})),window.fc_heartbeatTimer||(window.fc_heartbeatTimer=setInterval((()=>{n.readyState===WebSocket.OPEN&&n.send(JSON.stringify({type:"ping"}))}),3e4)),document.hidden||document.querySelectorAll("[id^='fc-chat-win-']").forEach((n=>{const t=n.id.replace("fc-chat-win-","");setTimeout((()=>{fc_try_auto_tmp_fnc(t,e,c)}),800)})),fc_processPush_fnc(e,c)},n.onmessage=n=>{let t;try{t=JSON.parse(n.data)}catch{return}"pong"!==t.type&&"update"===t.event&&(window.fc_priorityLock||fc_realTime_fnc("stream",e,c))},n.onerror=()=>{n.close()},n.onclose=()=>{window.fc_heartbeatTimer&&(clearInterval(window.fc_heartbeatTimer),window.fc_heartbeatTimer=null),window.fc_wsActive=!1,window.fc_wsConnecting=!1,document.hidden||window.fc_wsReconnectTimer||(window.fc_wsReconnectTimer=setTimeout((()=>{window.fc_wsReconnectTimer=null,fc_increaseBackoff_fnc(),fc_openWS_fnc(e,c)}),window.fc_streamBackoff))}}async function fc_realTime_fnc(e,c,n,t=0,i="",f=null){if(!window.fc_cfg?.widget_id)return!1;if(!e||!c||!n)return!1;if(window.fc_priorityLock)return!1;window.fc_priorityLock=!0;try{await fc_processPush_fnc(c,n)}catch(e){}try{let o=`${fc_base_url}${{conversation:"conversation",profile_update:"profile_update",location_update:"location_update"}[e]||"chat"}/${encodeURIComponent(window.fc_cfg.widget_id)}`;const d=9e3,s=3,_={"X-Requested-With":"XMLHttpRequest",Accept:"application/json"};let r;switch(e){case"send_file":if(!(i instanceof FormData))return!1;i.append("do",e),i.append("user_public_key",c),i.append("user_secret_key",n),i.append("id",t),i.append("offset",fc_offset),i.append("latitude",fc_latitude),i.append("longitude",fc_longitude),i.append("token",fc_token_fnc(8));const f=document.getElementById(`fc-file-${t}`);f?.files?.[0]&&i.append("data",f.files[0]),r=i;break;case"conversation":r=`conversation_id=${encodeURIComponent(t)}&user_id=${encodeURIComponent(i)}`,_["Content-Type"]="application/x-www-form-urlencoded";break;case"profile_update":case"location_update":r=`user_public_key=${encodeURIComponent(c)}&user_secret_key=${encodeURIComponent(n)}&data=${encodeURIComponent(JSON.stringify(i))}`,_["Content-Type"]="application/x-www-form-urlencoded";break;default:r=`do=${encodeURIComponent(e)}&user_public_key=${encodeURIComponent(c)}&user_secret_key=${encodeURIComponent(n)}&id=${encodeURIComponent(t)}&data=${encodeURIComponent(i)}&offset=${fc_offset}&latitude=${fc_latitude}&longitude=${fc_longitude}&token=${fc_token_fnc(8)}`,_["Content-Type"]="application/x-www-form-urlencoded"}const a=(e,c,n)=>{const t=new AbortController,i=setTimeout((()=>t.abort()),n);return fetch(e,{...c,signal:t.signal}).finally((()=>clearTimeout(i)))};let g=0;for(;g<=s;){try{const t=await a(o,{method:"POST",headers:_,body:r},d);if(!t.ok)throw new Error(`HTTP ${t.status}`);const i=await t.json();return"function"==typeof fc_doUpdates_fnc&&fc_doUpdates_fnc(i,e,c,n),"function"==typeof f&&f(i),!0}catch(e){if(g>=s)return!1;await new Promise((e=>setTimeout(e,600*(g+1))))}g++}return!1}finally{window.fc_priorityLock=!1,n&&"function"==typeof fc_getUpdates_fnc&&!window.fc_wsActive&&setTimeout((()=>{fc_getUpdates_fnc("initialize",window.fc_cfg,c,n)}),600)}}async function fc_processPush_fnc(e,c){if(!window.fc_pushLock){window.fc_pushLock=!0;try{const n=new IndexedDBWrapper(e,"push");await n.init();const t=await n.getAll();for(const i of t){if(await fc_push_fnc(i,e,c))try{await n.delete(i.id)}catch(e){}}}catch(e){}finally{window.fc_pushLock=!1}}}function fc_getUpdates_fnc(e,c,n,t){"initialize"===e&&c?.widget_id&&fc_user_id&&(window.fc_cfg=c,window.fc_last_user_public=n,window.fc_last_user_secret=t,window.fc_priorityLock||fc_openWS_fnc(n,t))}async function fc_delete_messages_fnc(e,c,n){if(!fc_cfg||!fc_cfg.widget_id)return;const t=document.getElementById(`fc-text-input-${e}`);if(!t)return;const i=document.getElementById(`fc-input-${e}`),f=i?Array.from(i.querySelectorAll(":scope input, :scope button, :scope textarea, :scope select")):[];if(!window.confirm("Are you sure you want to delete all messages in this chat?\n\nThis action is permanent and the messages cannot be recovered."))return;const o=`fc_delete_messages_lock_${e}`;if(!window[o]){window[o]=!0,fc_toggle_controls_fnc(f,!0);try{return await fc_realTime_fnc("delete_messages",c,n,e,"",(function(e){}))}finally{setTimeout((()=>{fc_toggle_controls_fnc(f,!1),t&&t.focus(),window[o]=!1}),1e3)}}}async function fc_exit_room_fnc(e,c,n){if(!fc_cfg?.widget_id)return;if(!document.getElementById(`fc-text-input-${e}`))return;const t=document.getElementById(`fc-input-${e}`),i=t?Array.from(t.querySelectorAll(":scope input, :scope button, :scope textarea, :scope select")):[];if(!window.confirm("Are you sure you want to exit this chat room?\n\n Important:\n- All your messages in this room will be permanently deleted and cannot be recovered.\n- Each room allows a maximum of 20 participants.\n- If you leave and the room becomes full, you will NOT be able to rejoin until someone else leaves.\n\nDo you want to continue?"))return;const f=`fc_exit_room_lock_${e}`;if(!window[f]){window[f]=!0,fc_toggle_controls_fnc(i,!0);try{return await fc_realTime_fnc("exit_room",c,n,e,"",(function(c){if(!c)return;const n=`#fc-chat-${e}`,t=fc_qs_fnc(`#fc-chat-win-${e}`);if(!t)return!1;fc_removeElement_fnc(t,300);const i=fc_qs_fnc(n);if(!i)return!1;fc_removeElement_fnc(i,300)}))}finally{setTimeout((()=>{window[f]=!1}),1e3)}}}async function fc_member_block_fnc(e,c,n,t){if(!fc_cfg?.widget_id||!e||!c)return;const i=`fc-participant-${e}`,f=document.getElementById(i);if(!f)return;if(!document.getElementById(`fc-text-input-${c}`))return;const o=document.getElementById(`fc-input-${c}`),d=o?Array.from(o.querySelectorAll(":scope input, :scope button, :scope textarea, :scope select")):[];if(!window.confirm("Are you sure you want to block this user from this room?\n\n- The user will not be able to rejoin this room for the next 24 hours.\n- You cannot unblock this user once blocked.\n- All of this user's messages will be permanently deleted."))return;const s=`fc_member_block_lock_${e}`;if(!window[s]){window[s]=!0,fc_toggle_controls_fnc(d,!0);try{return await fc_realTime_fnc("member_block",n,t,e,c,(function(e){e&&fc_removeElement_fnc(f,300)}))}finally{fc_toggle_controls_fnc(d,!1),setTimeout((()=>{window[s]=!1}),1e3)}}}async function fc_user_block_fnc(e,c,n,t){if(!fc_cfg||!fc_cfg.widget_id)return;if(!document.getElementById(`fc-text-input-${c}`))return;const i=document.getElementById(`fc-input-${c}`),f=i?Array.from(i.querySelectorAll(":scope input, :scope button, :scope textarea, :scope select")):[];if(!window.confirm("Are you sure you want to block this user?\n\n You will not be able to chat with this user for the next 24 hours.\n You will not see this user during this period.\n This conversation will be deleted.\n All messages in this conversation will be permanently deleted and cannot be recovered.\n\nAfter 24 hours, you may send a new chat request. You can chat again only if the user accepts."))return;const o=`fc_user_block_lock_${e}`;if(!window[o]){window[o]=!0,fc_toggle_controls_fnc(f,!0);try{return await fc_realTime_fnc("user_block",n,t,e,"",(function(e){if(!e)return;const n=`#fc-chat-${c}`,t=fc_qs_fnc(`#fc-chat-win-${c}`);if(!t)return!1;fc_removeElement_fnc(t,300);const i=fc_qs_fnc(n);if(!i)return!1;fc_removeElement_fnc(i,300)}))}finally{setTimeout((()=>{window[o]=!1}),1e3)}}}async function fc_chat_accept_fnc(e,c,n){if(!fc_cfg?.widget_id)return;const t=`fc_chat_accept_lock_${e}`;if(!window[t]){window[t]=!0;try{return await fc_realTime_fnc("chat_accept",c,n,e,"",(function(e){e&&fc_alert_fnc("Chat accept successfully!","success")}))}finally{setTimeout((()=>{window[t]=!1}),1e3)}}}async function fc_view_users_fnc(e,c,n){if(!fc_cfg?.widget_id||!e)return;if(!document.getElementById(`fc-chat-win-${e}`))return;const t=`fc_view_users_lock_${e}`;if(window[t])return;window[t]=!0;const i=fc_cfg.widget_id;try{return await fc_realTime_fnc("conversation",c,n,e,fc_user_id,(function(t){if(!t?.data)return;const{users:f,participants:o,chat:d}=t.data;if(!f||!o?.length||!d?.room_id)return;const s=fc_push_rooms?.[d.room_id];if(!s)return;const _=document.createDocumentFragment(),r=fc_el_fnc("div",`fc-profile-container-${i}`),a=fc_el_fnc("div",`fc-profile-left-${i}`),g=fc_el_fnc("div",`fc-avatar-wrap-${i}`);g.append(fc_el_fnc("span",`fc-statusDot-${i} fc-online-${i}`),fc_el_fnc("img",`fc-online-${i}`,{src:fc_dp_fnc("room"),alt:"Room",title:"Room"})),a.append(g,fc_el_fnc("div",`fc-statusText-${i} fc-statusColor-${i} fc-online-${i}`,{text:fc_safeText_fnc(s.title)}));const l=fc_el_fnc("div",`fc-profile-right-${i}`),w=String(fc_user_id)===String(d.admin_id);for(const e of o){const t=f[e.user_id];if(!t)continue;const o=String(t.user_id)===String(d.admin_id),s=w&&!o,_=fc_el_fnc("div",`fc-profile-row-${i}`,{id:`fc-participant-${t.user_id}`}),r=fc_el_fnc("div",`fc-profile-label-${i}`),a=String(t.status||"offline").toLowerCase(),g=fc_el_fnc("img",`fc-dp-${i} fc-${a}-${i}`,{src:fc_dp_fnc(t.gender||"unknown"),alt:fc_safeText_fnc(t.nickname||"User"),title:fc_safeText_fnc(t.nickname||"User")});let u;if(g.style.cursor="pointer",g.addEventListener("click",(()=>{fc_view_profile_fnc("Profile",t.user_id,!1,!1,c,n)}),{passive:!0}),r.append(g,fc_el_fnc("span",`fc-name-${i}`,{text:` ${fc_safeText_fnc(t.nickname)}`})),o)u=fc_el_fnc("div",`fc-profile-value-${i} fc-admin-${i}`,{text:"Admin"});else if(s){u=fc_el_fnc("div",`fc-profile-value-${i} fc-block-${i}`),u.innerHTML='\n              <svg width="14" height="14" viewBox="0 0 24 24"\n                   xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">\n                <circle cx="12" cy="12" r="10"\n                        fill="none" stroke="currentColor" stroke-width="2"></circle>\n                <line x1="6" y1="18" x2="18" y2="6"\n                      stroke="currentColor" stroke-width="2" stroke-linecap="round"></line>\n              </svg>\n            ',u.title="Block user",u.style.cursor="pointer";let e=!1;u.addEventListener("click",(()=>{e||(e=!0,fc_member_block_fnc(t.user_id,d.chat_id,c,n),setTimeout((()=>{e=!1}),800))}))}else u=fc_el_fnc("div",`fc-profile-value-${i}`,{text:"Participant"});_.append(r,u),l.appendChild(_)}r.append(a,l),_.appendChild(r),fc_dialog_fnc(e,"Conversation Participants",_)}))}finally{setTimeout((()=>{window[t]=!1}),1e3)}}async function fc_edit_profile_fnc(e,c){if(!fc_cfg?.widget_id||!fc_user_id)return;const n=fc_push_users?.[fc_user_id];if(!n)return;const t=fc_cfg.widget_id,i=document.createDocumentFragment(),f=(e,c,n)=>{const i=fc_el_fnc("select",`fc-select-${t} fc-profile-value-${t}`);return i.id=e,i.innerHTML=c,i.value=n??"",i},o=fc_el_fnc("div",`fc-profile-container-${t}`),d=fc_el_fnc("div",`fc-profile-left-${t}`),s=fc_el_fnc("div",`fc-avatar-wrap-${t}`),_=String(n.status||"offline").toLowerCase();s.append(fc_el_fnc("span",`fc-statusDot-${t} fc-${_}-${t}`),fc_el_fnc("img",`fc-${_}-${t}`,{src:fc_dp_fnc(n.gender),alt:"Profile picture",loading:"lazy"})),d.appendChild(s);const r=fc_el_fnc("div",`fc-profile-row-${t}`);r.append(fc_el_fnc("div",`fc-profile-label-${t}`,{text:"Status"}),f(`fc-pro-status-${t}`,'\n        <option value="online">Online</option>\n        <option value="away">Away</option>\n        <option value="busy">Busy</option>\n        <option value="offline">Offline</option>\n      ',_)),d.appendChild(r);const a=fc_el_fnc("div",`fc-profile-right-${t}`),g=(e,c)=>{const n=fc_el_fnc("div",`fc-profile-row-${t}`);n.append(fc_el_fnc("div",`fc-profile-label-${t}`,{text:e}),c),a.appendChild(n)};g("Nickname",fc_el_fnc("input",`fc-input-${t} fc-profile-value-${t}`,{id:`fc-pro-nickname-${t}`,type:"text",value:n.nickname||"",maxLength:32,placeholder:"Your Nickname"})),g("Gender",f(`fc-pro-gender-${t}`,'\n        <option value="male">Male</option>\n        <option value="female">Female</option>\n        <option value="not_specified">Not Specified</option>\n      ',n.gender));let l="";for(let e=18;e<=63;e++)l+=`<option value="${e}">${e}</option>`;g("Age",f(`fc-pro-age-${t}`,l,String(n.age||"").replace(/\D/g,""))),g("Looking For",f(`fc-pro-findgender-${t}`,'\n        <option value="male">Male</option>\n        <option value="female">Female</option>\n        <option value="any">Any</option>\n      ',n.findgender)),g("Age From",f(`fc-pro-agefrom-${t}`,l,String(n.agefrom||"").replace(/\D/g,""))),g("Age To",f(`fc-pro-ageto-${t}`,l,String(n.ageto||"").replace(/\D/g,"")));const w=fc_el_fnc("div",`fc-profile-action-${t}`),u=fc_el_fnc("button",`fc-accept-btn-${t}`,{text:"Update"});u.type="button",u.addEventListener("click",(async()=>{const n=document.getElementById(`fc-dialog-overlay-${t}-${fc_user_id}`),i=n?Array.from(n.querySelectorAll(":scope input, :scope button, :scope textarea, :scope select")):[],f=`fc_profile_lock_${t}`;if(window[f])return;window[f]=!0,fc_toggle_controls_fnc(i,!0);const o={status:document.getElementById(`fc-pro-status-${t}`)?.value,nickname:document.getElementById(`fc-pro-nickname-${t}`)?.value.trim(),gender:document.getElementById(`fc-pro-gender-${t}`)?.value,age:document.getElementById(`fc-pro-age-${t}`)?.value,findgender:document.getElementById(`fc-pro-findgender-${t}`)?.value,agefrom:document.getElementById(`fc-pro-agefrom-${t}`)?.value,ageto:document.getElementById(`fc-pro-ageto-${t}`)?.value};if(!o.nickname)return alert("Nickname is required");if(o.nickname.length>32)return alert("Maximum 32 characters for nickname");if(o.agefrom&&o.ageto&&Number(o.agefrom)>Number(o.ageto))return alert("Age From cannot be greater than Age To");try{await fc_realTime_fnc("profile_update",e,c,fc_user_id,o,(e=>{e&&(fc_alert_fnc("Profile updated","success"),p.close())}))}catch{alert("Profile update failed")}finally{setTimeout((()=>{fc_toggle_controls_fnc(i,!1),window[f]=!1}),1e3)}})),w.appendChild(u),o.append(d,a,w),i.appendChild(o);const p=fc_dialog_fnc(fc_user_id,"Edit Profile",i)}function fc_view_profile_fnc(e="Profile",c,n=!1,t=!1,i,f){if(!fc_cfg||!fc_cfg.widget_id)return;const o=n?fc_push_nearby?.[c]:fc_push_users?.[c];if(!o)return;const d=fc_el_fnc("div",`fc-profile-container-${fc_cfg.widget_id}`),s=fc_el_fnc("div",`fc-profile-left-${fc_cfg.widget_id}`),_=fc_el_fnc("div",`fc-avatar-wrap-${fc_cfg.widget_id}`),r=fc_el_fnc("span",`fc-statusDot-${fc_cfg.widget_id} fc-${String(o.status).toLowerCase()}-${fc_cfg.widget_id}`),a=fc_el_fnc("img",` fc-${String(o.status).toLowerCase()}-${fc_cfg.widget_id}`,{src:fc_dp_fnc(o.gender),alt:fc_safeText_fnc(o.nickname||"Profile picture")});_.append(r,a),s.appendChild(_);const g=fc_el_fnc("div",`fc-statusText-${fc_cfg.widget_id} fc-statusColor-${fc_cfg.widget_id} fc-${String(o.status).toLowerCase()}-${fc_cfg.widget_id}`,{text:fc_safeText_fnc(o.status||"-")});s.appendChild(g);const l=fc_el_fnc("div",`fc-profile-right-${fc_cfg.widget_id}`),w=(e,c,n=`fc-profile-row-${fc_cfg.widget_id}`)=>{const t=fc_el_fnc("div",n),i=fc_el_fnc("div",`fc-profile-label-${fc_cfg.widget_id}`,{text:fc_safeText_fnc(e)}),f=fc_el_fnc("div",`fc-profile-value-${fc_cfg.widget_id}`,{text:fc_safeText_fnc(c??"-")});t.append(i,f),l.appendChild(t)};w("Nickname",o.nickname),w("Gender",o.gender?.toUpperCase()),w("Age",o.age),w("Last Seen",o.last_seen),w("Distance",o.distance);const u=fc_el_fnc("div",`fc-profile-row-${fc_cfg.widget_id} fc-looking-${fc_cfg.widget_id}`,{text:"Looking For"});l.appendChild(u),w("Gender",o.findgender?.toUpperCase()),w("Age Range",`${o.agefrom??"-"} to ${o.ageto??"-"}`),d.append(s,l);const p=fc_dialog_fnc(c,e,d);if(t){const e=fc_el_fnc("div",`fc-profile-action-${fc_cfg.widget_id}`),c=fc_el_fnc("button",`fc-accept-btn-${fc_cfg.widget_id}`,{text:"Accept",type:"button"});c.onclick=async()=>{try{!0===await fc_chat_accept_fnc(o.user_id,i,f)&&p.close()}catch(e){}},e.appendChild(c),d.appendChild(e)}}function fc_dialog_fnc(e,c="Welcome",n="Thank you for visiting our website!"){if(!fc_cfg||!fc_cfg.widget_id)return;const t=`fc-dialog-overlay-${fc_cfg.widget_id}-${e}`;if(document.getElementById(t))return;const i=document.title;let f=!1;const o=setInterval((()=>{document.title=f?i:c,f=!f}),1e3),d=fc_el_fnc("div",`fc-dialog-overlay-${fc_cfg.widget_id}`,{id:t}),s=fc_el_fnc("div",`fc-dialog-box-${fc_cfg.widget_id}`);s.setAttribute("role","dialog"),s.setAttribute("aria-modal","true");const _=fc_el_fnc("div",`fc-dialog-header-${fc_cfg.widget_id}`),r=fc_el_fnc("span","",{text:c});r.id=`fc-dialog-title-${fc_cfg.widget_id}`;const a=fc_el_fnc("button",`fc-dialog-close-${fc_cfg.widget_id}`,{text:"",type:"button"});a.onclick=()=>w(),_.appendChild(r),_.appendChild(a);const g=fc_el_fnc("div",`fc-dialog-body-${fc_cfg.widget_id}`);if(n instanceof Node)g.appendChild(n);else{const e=fc_el_fnc("h6","",{text:n});g.appendChild(e)}function l(e){"Escape"===e.key&&w()}function w(){clearInterval(o),document.title=i,document.removeEventListener("keydown",l),d.remove()}return s.appendChild(_),s.appendChild(g),d.appendChild(s),document.body.appendChild(d),d.addEventListener("click",(e=>{e.target===d&&w()})),document.addEventListener("keydown",l),a.focus(),{close:w,overlay:d}}async function fc_send_text_message_fnc(e,c,n){if(!fc_cfg||!fc_cfg.widget_id)return;const t=document.getElementById(`fc-text-input-${e}`);if(!t)return;let i=t.value.trim();if(!i)return;const f=document.getElementById(`fc-input-${e}`),o=f?Array.from(f.querySelectorAll(":scope input, :scope button, :scope textarea, :scope select")):[],d=`fc_send_lock_${e}`;if(!window[d]){window[d]=!0,fc_toggle_controls_fnc(o,!0);try{await fc_realTime_fnc("send_text",c,n,e,i,(async function(f){if(!f)return;t.value="";const o=Number(f.data)||0;if(o>0){fc_display_message_fnc({message_id:o,chat_id:e,user_id:fc_user_id,message_type:"text",message_content:i},"send_text",null,c,n),window.fc_priorityLock=!1,await fc_realTime_fnc("stream",c,n)}}))}finally{setTimeout((()=>{fc_toggle_controls_fnc(o,!1),t&&t.focus(),window[d]=!1}),1e3)}}}function fc_send_file_fnc(e,c,n){if(!fc_cfg||!fc_cfg.widget_id)return;const t=document.getElementById(`fc-file-${e}`);if(!t)return;t.click();const i=async function(f){f.preventDefault();const o=document.getElementById(`fc-text-input-${e}`),d=document.getElementById(`fc-input-${e}`),s=d?Array.from(d.querySelectorAll(":scope input, :scope button, :scope textarea, :scope select")):[];if(!t.files||0===t.files.length)return fc_toggle_controls_fnc(s,!1),void t.removeEventListener("change",i);const _=t.files[0];if(!_)return fc_toggle_controls_fnc(s,!1),void t.removeEventListener("change",i);if(!["image/png","image/gif","image/jpeg"].includes(_.type))return alert("Only PNG, GIF, or JPEG images are allowed."),fc_toggle_controls_fnc(s,!1),t.value="",void t.removeEventListener("change",i);const r=new FormData;r.append("id",e),r.append("do","send_file"),r.append("data",t.files[0]);const a=`fc_send_lock_${e}`;if(!window[a]){window[a]=!0,fc_toggle_controls_fnc(s,!0);try{fc_realTime_fnc("send_file",c,n,e,r,(async function(f){if(!f)return;const o=URL.createObjectURL(t.files[0]),d=Number(f.data)||0;if(d>0){fc_display_message_fnc({message_id:d,chat_id:e,user_id:fc_user_id,message_type:"file",message_content:o,local:!0},"send_file",null,c,n),await fc_realTime_fnc("stream",c,n)}fc_toggle_controls_fnc(s,!1),t.removeEventListener("change",i)}))}finally{setTimeout((()=>{fc_toggle_controls_fnc(s,!1),o&&o.focus(),window[a]=!1}),1e3)}}};t.addEventListener("change",i)}function fc_alert_fnc(e,c="info"){if(!fc_cfg||!fc_cfg.widget_id)return;const n=fc_cfg.widget_id,t=document.getElementById(`fc-messenger-window-${n}`);if(!t)return;let i=t.querySelector(`.fc-alert-container-${n}`);i||(i=document.createElement("div"),i.className=`fc-alert-container-${n}`,Object.assign(i.style,{position:"absolute",bottom:"10px",left:"50%",transform:"translateX(-50%)",zIndex:"1000",width:"90%",maxWidth:"400px",pointerEvents:"none"}),t.appendChild(i));const f={info:"#3498db",success:"#2ecc71",warning:"#f39c12",danger:"#e74c3c"},o=document.createElement("div");o.className=`fc-alert-${n}`,Object.assign(o.style,{background:f[c]||f.info,color:"#fff",padding:"10px 14px",marginTop:"6px",borderRadius:"6px",boxShadow:"0 2px 6px rgba(0,0,0,0.2)",fontFamily:"Arial, sans-serif",fontSize:"13px",lineHeight:"1.4",cursor:"pointer",textAlign:"center",pointerEvents:"auto"}),o.textContent=e;const d=()=>i?.removeChild(o);o.addEventListener("click",d),setTimeout(d,5e3),i.appendChild(o)}function fc_dp_fnc(e){const c=(e||"").toLowerCase();return fc_cdn_url+"public/images/frontend/mint/"+({male:"male.jpg",female:"female.jpg",room:"room.jpg","not specified":"any.jpg"}[c]||"any.jpg")}function fc_wrap_room_fnc(e,c,n){if(!e||!fc_cfg||!fc_cfg.widget_id)return;let t="";const i=Number(e.joined),f=Number(e.blocked),o=Number(e.admin);0===i&&0===f?t=`\n      <a href="javascript:void(0)" \n         onclick="fc_join_room_fnc('${e.room_id}', '${c}', '${n}')" \n         title="Join Room">\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" fill="currentColor" style="vertical-align:middle;">\n          <path d="M201 95L345 239c9.4 9.4 9.4 24.6 0 33.9L201 417c-6.9 6.9-17.2 8.9-26.2 5.2S160 409.7 160 400v-64H48c-26.5 0-48-21.5-48-48v-64c0-26.5 21.5-48 48-48h112V112c0-9.7 5.8-18.5 14.8-22.2S194.1 88.2 201 95zm7 217v30.1l86.1-86.1-86.1-86.1v30.1c0 13.3-10.7 24-24 24H48v64h136c6.4 0 12.5 2.5 17 7s7 10.6 7 17zM344 432h72c26.5 0 48-21.5 48-48V128c0-26.5-21.5-48-48-48h-72c-13.3 0-24-10.7-24-24s10.7-24 24-24h72c53 0 96 43 96 96v256c0 53-43 96-96 96h-72c-13.3 0-24-10.7-24-24s10.7-24 24-24z"/>\n        </svg>\n      </a>`:1===i&&1===o&&(t='\n      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 640 640" fill="currentColor" style="vertical-align:middle;">\n        <path d="M345 151.2C354.2 143.9 360 132.6 360 120C360 97.9 342.1 80 320 80C297.9 80 280 97.9 280 120C280 132.6 285.9 143.9 295 151.2L226.6 258.8C216.6 274.5 195.3 278.4 180.4 267.2L120.9 222.7C125.4 216.3 128 208.4 128 200C128 177.9 110.1 160 88 160C65.9 160 48 177.9 48 200C48 221.8 65.5 239.6 87.2 240L119.8 457.5C124.5 488.8 151.4 512 183.1 512H456.9C488.6 512 515.5 488.8 520.2 457.5L552.8 240C574.5 239.6 592 221.8 592 200C592 177.9 574.1 160 552 160C529.9 160 512 177.9 512 200C512 208.4 514.6 216.3 519.1 222.7L459.7 267.3C444.8 278.5 423.5 274.6 413.5 258.9L345 151.2z"/>\n      </svg>');const d=fc_el_fnc("li",`fc-room-${fc_cfg.widget_id}`);d.id=`fc-room-${e.room_id}`;const s=fc_el_fnc("div",`fc-wrap-${fc_cfg.widget_id}`),_=fc_el_fnc("img");_.src=fc_dp_fnc("room");const r=fc_el_fnc("div",`fc-meta-${fc_cfg.widget_id}`);r.append(fc_el_fnc("p",`fc-name-${fc_cfg.widget_id}`,{text:fc_safeText_fnc(e.title)}),fc_el_fnc("p",`fc-preview-${fc_cfg.widget_id}`,{text:fc_safeText_fnc(e.total_users)}));const a=fc_el_fnc("div",`fc-action-${fc_cfg.widget_id}`);a.id=`fc-join-room-${e.room_id}`,a.innerHTML=t,s.append(_,r,a),d.appendChild(s);const g=fc_qs_fnc(`#fc-rooms-${fc_cfg.widget_id}`);g&&g.appendChild(d)}async function fc_join_room_fnc(e,c,n){if(!fc_cfg?.widget_id)return;const t=document.getElementById(`fc-room-${e}`),i=document.getElementById(`fc-join-room-${e}`),f=fc_push_rooms?.[e];if(!t||!i||!f)return;const o=`fc_room_lock_${e}`;if(!window[o]){window[o]=!0;try{return await fc_realTime_fnc("join_room",c,n,e,"",(function(e){e&&(fc_removeElement_fnc(i,300),fc_alert_fnc(`Joined ${f.title}`,"success"))}))}finally{setTimeout((()=>{window[o]=!1}),1e3)}}}function fc_nearbyIcon_fnc(e,c,n){if(!e)return"";const t=0===Number(e.chat_request),i={ask:`\n      <a href="javascript:void(0)" \n         onclick="fc_send_chat_request_fnc(${e.user_id}, '${c}', '${n}')" \n         title="Ask for Chat" \n         data-bs-toggle="tooltip">\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 640 640" fill="currentColor" style="vertical-align:middle;">\n          <path d="M536.4-26.3c9.8-3.5 20.6-1 28 6.3s9.8 18.2 6.3 28l-178 496.9c-5 13.9-18.1 23.1-32.8 23.1-14.2 0-27-8.6-32.3-21.7l-64.2-158c-4.5-11-2.5-23.6 5.2-32.6l94.5-112.4c5.1-6.1 4.7-15-.9-20.6s-14.6-6-20.6-.9L229.2 276.1c-9.1 7.6-21.6 9.6-32.6 5.2L38.1 216.8c-13.1-5.3-21.7-18.1-21.7-32.3 0-14.7 9.2-27.8 23.1-32.8l496.9-178z"/>\n        </svg>\n      </a>`,accepted:'\n      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 640 640" fill="currentColor" style="vertical-align:middle;">\n        <path d="M32 0C14.3 0 0 14.3 0 32S14.3 64 32 64l0 11c0 42.4 16.9 83.1 46.9 113.1l67.9 67.9-67.9 67.9C48.9 353.9 32 394.6 32 437l0 11c-17.7 0-32 14.3-32 32s14.3 32 32 32l320 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l0-11c0-42.4-16.9-83.1-46.9-113.1l-67.9-67.9 67.9-67.9c30-30 46.9-70.7 46.9-113.1l0-11c17.7 0 32-14.3 32-32S369.7 0 352 0L32 0zM96 75l0-11 192 0 0 11c0 19-5.6 37.4-16 53L112 128c-10.3-15.6-16-34-16-53zm16 309c3.5-5.3 7.6-10.3 12.1-14.9l67.9-67.9 67.9 67.9c4.6 4.6 8.6 9.6 12.2 14.9L112 384z"/>\n      </svg>'};return t?i.ask:i.accepted}async function fc_send_chat_request_fnc(e,c,n){if(!fc_cfg?.widget_id)return;const t=document.getElementById(`fc-nearby-user-${e}`),i=document.getElementById(`fc-chat-request-${e}`);if(!t||!i)return;i.innerHTML='\n    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" \n         viewBox="0 0 640 640" fill="currentColor" style="vertical-align:middle;">\n      <path d="M32 0C14.3 0 0 14.3 0 32S14.3 64 32 64l0 11c0 42.4 16.9 83.1 46.9 113.1l67.9 67.9-67.9 67.9C48.9 353.9 32 394.6 32 437l0 11c-17.7 0-32 14.3-32 32s14.3 32 32 32l320 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l0-11c0-42.4-16.9-83.1-46.9-113.1l-67.9-67.9 67.9-67.9c30-30 46.9-70.7 46.9-113.1l0-11c17.7 0 32-14.3 32-32S369.7 0 352 0L32 0zM96 75l0-11 192 0 0 11c0 19-5.6 37.4-16 53L112 128c-10.3-15.6-16-34-16-53zm16 309c3.5-5.3 7.6-10.3 12.1-14.9l67.9-67.9 67.9 67.9c4.6 4.6 8.6 9.6 12.2 14.9L112 384z"/>\n    </svg>\n  ';const f=`fc_nearby_user_lock_${e}`;if(!window[f]){window[f]=!0;try{return await fc_realTime_fnc("chat_request",c,n,e,"",(function(e){e&&(t&&fc_removeElement_fnc(t,300),fc_alert_fnc("Chat request sent!","success"))}))}finally{setTimeout((()=>{window[f]=!1}),1e3)}}}function fc_wrap_nearby_fnc(e,c,n,t){if(!e||!fc_cfg?.widget_id)return;const i=fc_cfg.widget_id,f=fc_el_fnc("li",`fc-nearby-${i}`);f.id=`fc-nearby-user-${e.user_id}`;const o=fc_el_fnc("span",`fc-statusDot-${i} fc-${String(e.status).toLowerCase()}-${i}`),d=fc_el_fnc("a");d.href="javascript:void(0)",d.onclick=()=>fc_view_profile_fnc("Profile",e.user_id,!0,!1,n,t);const s=fc_el_fnc("img",`fc-${String(e.status).toLowerCase()}-${i}`,{src:fc_dp_fnc(e.gender),alt:fc_safeText_fnc(e.nickname)});d.appendChild(s);const _=fc_el_fnc("div",`fc-meta-${i}`),r=fc_el_fnc("p",`fc-name-${i}`,{text:fc_safeText_fnc(e.nickname)}),a=fc_el_fnc("p",`fc-preview-${i}`,{text:fc_safeText_fnc(e.distance)});_.append(r,a);const g=fc_el_fnc("div",`fc-action-${i}`);g.id=`fc-chat-request-${e.user_id}`,g.innerHTML=fc_nearbyIcon_fnc(e,n,t);const l=fc_el_fnc("div",`fc-wrap-${i}`);if(l.append(o,d,_,g),f.appendChild(l),c)c.appendChild(f);else{const e=fc_qs_fnc(`#fc-nearby-${i}`);e&&e.prepend(f)}}function fc_isNonEmptyObject_fnc(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)&&Object.keys(e).length>0}function fc_isEmptyArray_fnc(e){return null==e||0===(e||[]).length}function fc_isElementExist_fnc(e){if(null!=e){return null!==document.getElementById(e)}return!1}function fc_isEmpty_fnc(e){return"string"==typeof e||Array.isArray(e)?0===e.length:null==e}function fc_escapeHtml_fnc(e){return String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function fc_chat_update_fnc(e,c,n,t){if(!e||!fc_cfg?.widget_id)return;const i=fc_cfg.widget_id,f=e.chat_id,o=`fc-chat-${f}`;if(fc_isElementExist_fnc(o))return;let d,s,_,r,a,g;0===Number(e.room_id)?(d=(c?.status??"offline").toLowerCase(),s=c?.gender??"Unknown",_=c?.distance??"",r=c?.user_id??"",a=fc_safeText_fnc(c?.nickname??"Unknown"),g="user"):(d="online",s="Room",_="Users: "+(e.total_participants??0),r=e.room_id,a=fc_safeText_fnc(c?.title??"Room"),g="room");const l=fc_dp_fnc(s),w=fc_el_fnc("li",`fc-chat-${i}`);w.id=o;const u=fc_el_fnc("div",`fc-wrap-${i} fc-link-${i}`);u.setAttribute("onclick",`fc_start_chat_fnc('${f}', '${g}', '${n}', '${t}', true)`);const p=fc_el_fnc("span",`fc-statusDot-${i} fc-${d}-${i}`);p.id=`fc-chat-status-${f}`;const m=fc_el_fnc("img",`fc-${d}-${i}`,{src:l,alt:a}),h=fc_el_fnc("div",`fc-meta-${i}`),$=fc_el_fnc("p",`fc-name-${i}`,{text:a}),b=fc_el_fnc("p",`fc-preview-${i}`,{text:_});b.id=`fc-preview-${f}`,h.append($,b);const x=fc_el_fnc("div",`fc-action-${i}`);x.id=`fc-chat-badge-${f}`,x.innerHTML="",u.append(p,m,h,x),w.appendChild(u);const v=fc_qs_fnc(`#fc-chats-${i}`);v&&v.prepend(w);const y=fc_qs_fnc(`#fc-chat-${r}`);y&&y.remove()}window.fc_priorityLock=!1,window.fc_pushLock=!1,window.fc_streamBackoff=1e3,window.fc_streamBackoffMax=15e3,window.fc_last_user_public=null,window.fc_last_user_secret=null,window.fc_ws=null,window.fc_wsActive=!1,window.fc_wsConnecting=!1,window.fc_wsReconnectTimer=null,window.fc_heartbeatTimer=null;let fc_audioCache={};function fc_sound_fnc(e="notification",c=""){if(!fc_base_url)return;if(window.fc_sound_muted)return;const n={message:"public/audios/message.mp3",initialize:"public/audios/initialize.mp3",notification:"public/audios/notification.mp3"},t=fc_cdn_url+(n[e]||n.notification);if(c){const e=document.getElementById(c);if(e&&e.contains(document.activeElement))return}try{fc_audioCache[e]||(fc_audioCache[e]=new Audio(t));const c=fc_audioCache[e];c.currentTime=0,c.play().catch((e=>{const n=()=>c.play();document.addEventListener("click",n,{once:!0}),document.addEventListener("keydown",n,{once:!0})}))}catch(e){}}function fc_message_status_fnc(e,c=0){if(!fc_cfg||!fc_cfg.widget_id)return;if(!e||!e.message_id||!e.chat_id)return;const n=fc_qs_fnc(`#fc-message-status-${e.message_id}`);if(!n)return void(c<5&&requestAnimationFrame((()=>fc_message_status_fnc(e,c+1))));const t=e.user_id===fc_user_id,i=Object.freeze({sending:'\n          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">\n            <path d="M8 3.5a.5.5 0 0 1 .5.5v4l2.5 1.5a.5.5 0 0 1-.5.866l-3-1.8A.5.5 0 0 1 7.5 8V4a.5.5 0 0 1 .5-.5z"/>\n            <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1" fill="none"/>\n          </svg>\n        ',sent:'\n          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">\n            <path d="M13.485 1.929a.75.75 0 0 1 0 1.06L6.06 10.414 2.515 6.87a.75.75 0 0 1 1.06-1.06l2.485 2.485 6.364-6.364a.75.75 0 0 1 1.06 0z"/>\n          </svg>\n        ',delivered:'\n          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">\n            <path d="M6.354 10.354a.5.5 0 0 1-.708 0L2.5 7.207l.707-.707L6 9.293l6.793-6.793.707.707-7.146 7.147z"/>\n            <path d="M12.354 10.354a.5.5 0 0 1-.708 0L8.5 7.207l.707-.707L12 9.293l2.793-2.793.707.707-3.146 3.147z"/>\n          </svg>\n        ',seen:'\n          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16"> <path d="M2 2h12v12H2z" fill="none"/> <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 2a5 5 0 1 1 0 10A5 5 0 0 1 8 3z"/> </svg>\n        ',info:'\n          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">\n            <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 2a5 5 0 1 1 0 10A5 5 0 0 1 8 3z"/>\n            <path d="M7.002 11h2V7h-2v4zm0-6h2V3h-2v2z"/>\n          </svg>\n        '});n.classList.remove(`fc-seen-${fc_cfg.widget_id}`);const f=Number(e.message_status);if(t)switch(f){case 1:n.innerHTML=i.sent;break;case 2:n.innerHTML=i.delivered;break;case 3:n.innerHTML=i.seen,n.classList.add(`fc-seen-${fc_cfg.widget_id}`);break;default:n.innerHTML=i.sending}else n.innerHTML=i.info;const o=fc_qs_fnc(`#fc-messages-${e.chat_id}`);o&&(requestAnimationFrame((()=>{o.scrollTop=o.scrollHeight})),setTimeout((()=>{o.scrollTop=o.scrollHeight}),600))}function fc_display_message_fnc(e,c,n=null,t,i){if(!fc_cfg?.widget_id)return;if(!e?.message_id||!e?.chat_id)return;const f=fc_cfg.widget_id,o=String(e.message_id),d=`fc-message-${o}`,s=n||fc_fragment_fnc();if(fc_qs_fnc(`#${d}`)||s.querySelector(`#${d}`)||window.fc_rendered_messages&&window.fc_rendered_messages.has(o))return void("system"!==e.message_type&&fc_message_status_fnc(e));if(window.fc_rendered_messages||(window.fc_rendered_messages=new Set),window.fc_rendered_messages.add(o),"system"===e.message_type){const c=fc_el_fnc("li",`fc-system-${f}`,{id:d}),o=fc_el_fnc("p",`fc-system-text-${f}`,{text:fc_safeText_fnc(e.message_content||"")});if(o.style.cursor="pointer",o.addEventListener("click",(()=>{fc_view_profile_fnc("Profile",e.user_id,!1,!1,t,i)}),{passive:!0}),c.appendChild(o),s.appendChild(c),!n){const c=fc_qs_fnc(`#fc-conversation-${e.chat_id}`);c&&requestAnimationFrame((()=>{c.appendChild(s),c.parentElement.scrollTop=c.parentElement.scrollHeight}))}const _=fc_qs_fnc(`#fc-preview-${e.chat_id}`);return _&&(_.innerHTML=fc_safeText_fnc(e.message_content||"")),void fc_on_new_message_arrived_fnc(e.chat_id)}const _=fc_push_users?.[e.user_id];if(!_)return;const r=e.user_id!==fc_user_id,a=r?"replies":"sent",g=(_.status||"offline").toLowerCase();let l="",w="";if("text"===e.message_type)l=fc_safeText_fnc(e.message_content||""),w=l;else{const c=!0===e.local?e.message_content:`${fc_cdn_url}public/uploads/${e.message_content}`;l=`<img src="${c}"\n            class="fc-lightbox-thumb-${f}"\n            data-full="${c}"\n            loading="eager"\n            alt="" />`,w='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">\n         <path d="M14.002 3a2 2 0 0 0-2-2H4.002a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h8.002a2 2 0 0 0 2-2V3z"/>\n       </svg>'}const u=fc_el_fnc("li",`user-${_.user_id} fc-${a}-${f}`,{id:d}),p=fc_el_fnc("span",`fc-nickname-${f} fc-statusColor-${f} fc-${g}-${f}`,{text:_.nickname||"Unknown"}),m=fc_el_fnc("img",`fc-dp-${f} fc-${g}-${f}`,{src:fc_dp_fnc(_.gender||"unknown"),alt:"View Profile"});m.style.cursor="pointer",m.addEventListener("click",(()=>{fc_view_profile_fnc("Profile",_.user_id,!1,!1,t,i)}));const h=fc_el_fnc("p");h.innerHTML=l;const $=fc_el_fnc("span",`fc-status-${f}`,{id:`fc-message-status-${o}`});if(u.append(p,m,h,$),s.appendChild(u),!n){const c=fc_qs_fnc(`#fc-conversation-${e.chat_id}`);c&&(requestAnimationFrame((()=>{c.appendChild(s),c.parentElement.scrollTop=c.parentElement.scrollHeight})),setTimeout((()=>{c.parentElement.scrollTop=c.parentElement.scrollHeight}),600))}r&&"stream"===c&&(fc_on_new_message_arrived_fnc(e.chat_id),fc_sound_fnc("message",`fc-chat-win-${e.chat_id}`)),r&&3!==Number(e.message_status)&&(fc_add_unseen_message_fnc(e.chat_id,e.message_id),fc_update_seen_badge_fnc(e.chat_id));const b=fc_qs_fnc(`#fc-preview-${e.chat_id}`);b&&(b.innerHTML=w),fc_message_status_fnc(e)}function fc_blink_chat_header_fnc(e){if(!fc_cfg||!fc_cfg.widget_id)return;const c=fc_qs_fnc(`#fc-chat-win-${e}`);if(!c)return;const n=fc_qs_fnc(`.fc-chat-info-${fc_cfg.widget_id}`,c);if(!n)return;const t=fc_qs_fnc("input, textarea",c);if(t&&document.activeElement===t)return;n.classList.add(`fc-blink-${fc_cfg.widget_id}`);const i=()=>n.classList.remove(`fc-blink-${fc_cfg.widget_id}`);n.addEventListener("click",i,{once:!0});const f=n=>{n.target.closest(`#fc-chat-win-${e}`)&&(i(),c.removeEventListener("click",f),c.removeEventListener("focusin",f))};c.addEventListener("click",f),c.addEventListener("focusin",f)}async function fc_send_tmp_fnc(e,c,n,t,i=0){if(window.fc_priorityLock)return;if(!fc_cfg||!fc_cfg.widget_id)return;if(!c||!e)return;const f=JSON.stringify({type:c,id:e,time:Math.floor(Date.now()/1e3)}),o=`fc_${c}_lock_${i}_${e}`;if(!window[o]){window[o]=!0;try{await fc_realTime_fnc("tmp",n,t,i,f,(async function(f){if(f&&f.status){if("read"===c){const c=window.fc_unread_messages.get(i);c&&(c.delete(e),fc_update_seen_badge_fnc(i))}if("seen"===c){const c=Number(window.fc_unseen_notifications)||0;window.fc_unseen_notifications=Math.max(c-1,0),fc_countNotification_fnc(n,t);const i=document.getElementById(`fc-notification-${e}`);i&&i.classList.remove(`fc-unread-${fc_cfg.widget_id}`)}}else setTimeout((()=>{fc_send_tmp_fnc(e,c,n,t,i)}),2e3)}))}catch(e){}finally{setTimeout((()=>{window[o]=!1}),1e3)}}}function fc_try_auto_tmp_fnc(e,c,n){if(0===window.fc_unread_messages.size)return;if(window.fc_priorityLock)return;if(!fc_cfg?.widget_id)return;if(!e||!window.fc_unread_messages.has(e))return;if(!document.hasFocus())return;const t=window.fc_unread_messages.get(e);if(!t||0===t.size)return;const i=fc_qs_fnc(`#fc-chat-win-${e}`);if(!i||!i.contains(document.activeElement)||i.classList.contains(`fc-hidden-${fc_cfg.widget_id}`))return;let f=0;for(const i of t){window[`fc_seen_lock_${e}_${i}`]||(f+=500,setTimeout((()=>{fc_send_tmp_fnc(i,"read",c,n,e)}),f))}}function fc_add_unseen_message_fnc(e,c){window.fc_unread_messages.has(e)||window.fc_unread_messages.set(e,new Set),window.fc_unread_messages.get(e).add(c)}function fc_on_new_message_arrived_fnc(e){fc_cfg&&fc_cfg.widget_id&&e&&fc_cfg&&fc_cfg.widget_id&&fc_blink_chat_header_fnc(e)}function fc_update_seen_badge_fnc(e){if(!fc_cfg||!fc_cfg.widget_id)return;const c=fc_qs_fnc(`#fc-chats-badge-${fc_cfg.widget_id}`),n=fc_qs_fnc(`#fc-chat-badge-${e}`),t=fc_qs_fnc(`#fc-chat-${e}`);if(!c||!n||!t)return;const i=window.fc_unread_messages.get(e),f=i?i.size:0;let o=0;window.fc_unread_messages.forEach((e=>{o+=e.size})),f>0?(n.textContent=f,n.classList.add(`fc-badge-${fc_cfg.widget_id}`),t.classList.add(`fc-unread-${fc_cfg.widget_id}`)):(n.textContent="",n.classList.remove(`fc-badge-${fc_cfg.widget_id}`),t.classList.remove(`fc-unread-${fc_cfg.widget_id}`)),o>0?(c.textContent=o,c.classList.add(`fc-badge-${fc_cfg.widget_id}`)):(c.textContent="",c.classList.remove(`fc-badge-${fc_cfg.widget_id}`))}document.addEventListener("click",(function(e){if(!fc_cfg||!fc_cfg.widget_id)return;const c=e.target.closest(`.fc-lightbox-thumb-${fc_cfg.widget_id}`);if(!c)return;if(document.querySelector(`.fc-lightbox-overlay-${fc_cfg.widget_id}`))return;const n=c.dataset.full||c.src;if(!n)return;const t=document.createElement("div");t.className=`fc-lightbox-overlay-${fc_cfg.widget_id}`,t.innerHTML=`<img src="${n}" alt="">`,t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.setAttribute("aria-label","Image preview"),t.tabIndex=-1,t.focus(),t.addEventListener("click",(()=>{t.remove(),document.body.style.overflow="",c.focus()}));const i=e=>{"Escape"!==e.key&&"Enter"!==e.key&&" "!==e.key||(t.remove(),document.body.style.overflow="",c.focus(),document.removeEventListener("keydown",i))};document.addEventListener("keydown",i),document.body.appendChild(t),document.body.style.overflow="hidden"})),document.addEventListener("visibilitychange",(()=>{!document.hidden&&window.fc_last_user_public&&window.fc_last_user_secret&&window.fc_unread_messages.forEach(((e,c)=>{fc_try_auto_tmp_fnc(c,window.fc_last_user_public,window.fc_last_user_secret)}))})),document.addEventListener("focusin",(e=>{if(0===window.fc_unread_messages.size)return;const c=e.target.closest("[id^='fc-chat-win-']");if(c&&window.fc_last_user_public&&window.fc_last_user_secret){const e=c.id.replace("fc-chat-win-","");window.fc_unread_messages.has(e)&&fc_try_auto_tmp_fnc(e,window.fc_last_user_public,window.fc_last_user_secret)}}));const fc_chat_state={maxVisible:3,openOrder:[],hiddenQueue:[],containersInitialized:!1};function fc_init_chat_dock_fnc(e){if(!fc_cfg||!fc_cfg.widget_id)return;if(fc_chat_state.containersInitialized)return;const c=fc_el_fnc("div",`fc-chat-dock-${fc_cfg.widget_id}`,{id:`fc-chat-dock-${fc_cfg.widget_id}`});document.body.appendChild(c),fc_chat_state.containersInitialized=!0}function fc_close_chat_fnc(e){if(!fc_cfg||!fc_cfg.widget_id)return;const c=fc_qs_fnc(`#fc-chat-win-${e}`);if(!c)return;c.classList.add(`fc-hidden-${fc_cfg.widget_id}`),fc_chat_state.openOrder=fc_chat_state.openOrder.filter((c=>c!==e)),Array.isArray(fc_chat_state.hiddenQueue)&&(fc_chat_state.hiddenQueue=fc_chat_state.hiddenQueue.filter((c=>c!==e)));const n=fc_chat_state.hiddenQueue?.shift();if(n&&!fc_chat_state.openOrder.includes(n)){fc_chat_state.openOrder.push(n);const e=fc_qs_fnc(`#fc-chat-win-${n}`);e&&e.classList.remove(`fc-hidden-${fc_cfg.widget_id}`)}}function fc_register_chat_window_fnc(e){if(!fc_cfg||!fc_cfg.widget_id)return;if(fc_chat_state.openOrder.includes(e))return;if(fc_chat_state.openOrder.length>=fc_chat_state.maxVisible){const e=fc_chat_state.openOrder.shift(),c=fc_qs_fnc(`#fc-chat-win-${e}`);c&&c.classList.add(`fc-hidden-${fc_cfg.widget_id}`),Array.isArray(fc_chat_state.hiddenQueue)&&!fc_chat_state.hiddenQueue.includes(e)&&fc_chat_state.hiddenQueue.push(e)}fc_chat_state.openOrder.push(e);const c=fc_qs_fnc(`#fc-chat-win-${e}`);c&&c.classList.remove(`fc-hidden-${fc_cfg.widget_id}`)}function fc_focus_chat_window_fnc(e){if(!fc_cfg||!fc_cfg.widget_id)return;if(fc_chat_state.openOrder=fc_chat_state.openOrder.filter((c=>c!==e)),fc_chat_state.openOrder.length>=fc_chat_state.maxVisible){const e=fc_chat_state.openOrder.shift(),c=fc_qs_fnc(`#fc-chat-win-${e}`);c&&c.classList.add(`fc-hidden-${fc_cfg.widget_id}`),Array.isArray(fc_chat_state.hiddenQueue)&&!fc_chat_state.hiddenQueue.includes(e)&&fc_chat_state.hiddenQueue.push(e)}fc_chat_state.openOrder.push(e);const c=fc_qs_fnc(`#fc-chat-win-${e}`);c&&c.classList.remove(`fc-hidden-${fc_cfg.widget_id}`)}function fc_minimize_chat_fnc(e){if(!fc_cfg||!fc_cfg.widget_id)return;const c=fc_qs_fnc(`#fc-chat-win-${e}`);if(!c)return;c.classList.add(`fc-minimized-${fc_cfg.widget_id}`);[`fc-chatMinimize-${e}`,`fc-chatClose-${e}`,`fc-chatExit-${e}`,`fc-chatProfile-${e}`,`fc-chatRemove-${e}`,`fc-chatBlock-${e}`].forEach((e=>{const c=fc_qs_fnc(`#${e}`);c&&(c.style.display="none")})),fc_qsa_fnc(`.fc-icon-btn-${fc_cfg.widget_id}`,c).forEach((c=>{c.id.includes(`fc-chatMaximize-${e}`)||(c.style.display="none")}));const n=fc_qs_fnc(`#fc-chatMaximize-${e}`);n&&(n.style.display="inline-block")}function fc_maximize_chat_fnc(e){if(!fc_cfg||!fc_cfg.widget_id)return;const c=fc_qs_fnc(`#fc-chat-win-${e}`);if(!c)return;c.classList.remove(`fc-minimized-${fc_cfg.widget_id}`);[`fc-chatMinimize-${e}`,`fc-chatClose-${e}`,`fc-chatExit-${e}`,`fc-chatProfile-${e}`,`fc-chatRemove-${e}`,`fc-chatBlock-${e}`].forEach((e=>{const c=fc_qs_fnc(`#${e}`);c&&(c.style.display="inline-block")})),fc_qsa_fnc(`.fc-icon-btn-${fc_cfg.widget_id}`,c).forEach((c=>{c.id.includes(`fc-chatMaximize-${e}`)||(c.style.display="inline-block")}));const n=fc_qs_fnc(`#fc-chatMaximize-${e}`);n&&(n.style.display="none")}function fc_scroll_messages_bottom_fnc(e){if(!fc_cfg||!fc_cfg.widget_id)return;const c=fc_qs_fnc(`#fc-messages-${e}`);if(!c)return;const n=()=>{c.scrollTop=c.scrollHeight};requestAnimationFrame(n);const t=c.querySelectorAll("img");if(!t.length)return;let i=0;t.forEach((e=>{e.complete||(i++,e.addEventListener("load",(()=>{0==--i&&requestAnimationFrame(n)}),{once:!0}))})),i>0&&setTimeout(n,600)}function fc_start_chat_fnc(e,c,n,t,i=!0){if(!fc_cfg||!fc_cfg.widget_id)return;fc_init_chat_dock_fnc(e);const f=`fc-chat-win-${e}`;let o=document.getElementById(f);if(o)return i&&(o.classList.remove(`fc-hidden-${fc_cfg.widget_id}`),fc_register_chat_window_fnc(e),fc_focus_chat_window_fnc(e),fc_maximize_chat_fnc(e)),void fc_scroll_messages_bottom_fnc(e);const d=fc_push_chats?.[e];if(!d||fc_isEmptyArray_fnc(d))return;const s=Number(d.room_id||0),_=Number(d.user_id||0);let r,a,g,l,w,u=null;if(0===s){const e=_===Number(fc_user_id)?d.recipient_id:d.user_id;u=fc_push_users?.[e]||null}else u=fc_push_rooms?.[d.room_id]||null;if(!u||fc_isEmptyArray_fnc(u))return;0===s?(r=String(u.status||"offline").toLowerCase(),a=u.gender||"unknown",g=u.last_seen||"",l=fc_safeText_fnc(u.nickname||"Unknown"),w=`<button id="fc-chatBlock-${e}" class="fc-icon-btn-${fc_cfg.widget_id}" title="Block User" onclick="fc_user_block_fnc('${u.user_id}', '${e}', '${n}', '${t}')"><svg width="12" height="12" viewBox="0 0 24 24"\n         xmlns="http://www.w3.org/2000/svg">\n      <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="3"/>\n      <line x1="6" y1="18" x2="18" y2="6" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>\n    </svg>\n    </button><button id="fc-chatProfile-${e}" class="fc-icon-btn-${fc_cfg.widget_id}" title="View Profile" onclick="fc_view_profile_fnc('Profile', '${u.user_id}', false, false, '${n}', '${t}')"><svg class="profile-icon" xmlns="http://www.w3.org/2000/svg" \n         viewBox="0 0 448 512" width="12" height="12" fill="currentColor">\n      <path d="M224 248a120 120 0 1 0 0-240 120 120 0 1 0 0 240zm-29.7 56C95.8 304 16 383.8 16 482.3 16 498.7 29.3 512 45.7 512l356.6 0c16.4 0 29.7-13.3 29.7-29.7 0-98.5-79.8-178.3-178.3-178.3l-59.4 0z"/>\n    </svg>\n    </button>`):(r="online",a="Room",g="Users: "+(d.total_participants??""),l=fc_safeText_fnc(u.title||"Room"),w=`<button id="fc-chatExit-${e}" class="fc-icon-btn-${fc_cfg.widget_id}" title="Exit Room" onclick="fc_exit_room_fnc('${e}', '${n}', '${t}')"><svg class="logout-icon" xmlns="http://www.w3.org/2000/svg" \n         viewBox="0 0 512 512" width="12" height="12" fill="currentColor">\n      <path d="M505 273c9.4-9.4 9.4-24.6 0-33.9L361 95c-6.9-6.9-17.2-8.9-26.2-5.2S320 102.3 320 112l0 80-112 0c-26.5 0-48 21.5-48 48l0 32c0 26.5 21.5 48 48 48l112 0 0 80c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2L505 273zM160 96c17.7 0 32-14.3 32-32s-14.3-32-32-32L96 32C43 32 0 75 0 128L0 384c0 53 43 96 96 96l64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32l64 0z"/>\n    </svg>\n    </button><button id="fc-chatUsers-${e}" class="fc-icon-btn-${fc_cfg.widget_id}" title="View Users" onclick="fc_view_users_fnc('${e}', '${n}', '${t}')"><svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"\n     xmlns="http://www.w3.org/2000/svg" aria-hidden="true">\n  <path d="M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 3-1.34 3-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5C15 14.17 10.33 13 8 13zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h7v-2.5c0-2.33-4.67-3.5-7-3.5z"/>\n</svg>\n    </button>`);const p=fc_el_fnc("div",`fc-chat-win-${fc_cfg.widget_id}`,{id:f});i||p.classList.add(`fc-hidden-${fc_cfg.widget_id}`);const m=fc_fragment_fnc();p.innerHTML=`<div class="fc-chat-info-${fc_cfg.widget_id}">\n            <span class="fc-statusDot-${fc_cfg.widget_id} fc-${r}-${fc_cfg.widget_id}"></span>\n            <img class="fc-dp-${fc_cfg.widget_id} fc-${r}-${fc_cfg.widget_id}" src="${fc_dp_fnc(a)}" alt="${a}" />\n            <div class="fc-chat-title-${fc_cfg.widget_id}">\n              <p class="fc-nickname-${fc_cfg.widget_id} fc-statusColor-${fc_cfg.widget_id} fc-${r}-${fc_cfg.widget_id}">${l}</p>\n              <p class="fc-status-${fc_cfg.widget_id}">${fc_safeText_fnc(g)}</p>\n            </div>\n            <div class="fc-chat-icons-${fc_cfg.widget_id}">\n              ${w}\n              <button id="fc-chatRemove-${e}" class="fc-icon-btn-${fc_cfg.widget_id}" title="Remove Chat History" onclick="fc_delete_messages_fnc('${e}', '${n}', '${t}')"><svg xmlns="http://www.w3.org/2000/svg" \n     width="12" height="12" \n     viewBox="0 0 576 512" \n     fill="currentColor">\n  <path d="M41-25C31.6-34.3 16.4-34.3 7-25S-2.3-.4 7 9L535 537c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-96.6-96.6c44.4-43.2 71.6-101.8 71.6-166.5 0-132.5-114.6-240-256-240-63 0-120.8 21.4-165.4 56.8L41-25zm19.4 155C42.2 163 32 200.3 32 239.9 32 294.2 51.2 344.2 83.6 384.4L34.8 476.7c-4.8 9-3.3 20 3.6 27.5S56.1 514 65.5 510l118.4-50.7c31.8 13.3 67.1 20.7 104.1 20.7 36.4 0 70.9-7.1 102.3-19.9L60.3 130.1z"/>\n</svg>\n    </button>\n              <button id="fc-chatMinimize-${e}" class="fc-icon-btn-${fc_cfg.widget_id}" title="Minimize" onclick="fc_minimize_chat_fnc('${e}')"><svg class="minus-icon" xmlns="http://www.w3.org/2000/svg" \n         viewBox="0 0 512 512" width="12" height="12" fill="currentColor">\n      <path d="M0 416c0-17.7 14.3-32 32-32l448 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32z"/>\n    </svg>\n    </button>\n              <button id="fc-chatMaximize-${e}" class="fc-icon-btn-${fc_cfg.widget_id}" title="Maximize" onclick="fc_maximize_chat_fnc('${e}')" style="display: none;"><svg class="expand-icon" xmlns="http://www.w3.org/2000/svg" \n         viewBox="0 0 448 512" width="12" height="12" fill="currentColor">\n      <path d="M32 32C14.3 32 0 46.3 0 64l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 32zM64 352c0-17.7-14.3-32-32-32S0 334.3 0 352l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96z"/>\n    </svg>\n    </button>\n              <button id="fc-chatClose-${e}" class="fc-icon-btn-${fc_cfg.widget_id}" title="Close" onclick="fc_close_chat_fnc('${e}')"><svg class="close-icon" xmlns="http://www.w3.org/2000/svg" \n         viewBox="0 0 384 512" width="12" height="12" fill="currentColor">\n      <path d="M55.1 73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L147.2 256 9.9 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192.5 301.3 329.9 438.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.8 256 375.1 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192.5 210.7 55.1 73.4z"/>\n    </svg>\n    </button>\n            </div>\n          </div>\n          <div class="fc-messages-${fc_cfg.widget_id}" id="fc-messages-${e}">\n            <ul id="fc-conversation-${e}"></ul>\n          </div>\n          <div class="fc-inputs-${fc_cfg.widget_id}" id="fc-input-${e}">\n            <div class="fc-wrap-${fc_cfg.widget_id}">\n              <input type="text" placeholder="Write your message..." name="fc-text-input-${e}" id="fc-text-input-${e}" />\n              <form class="fc-file-form-${fc_cfg.widget_id}" name="file_frm_${e}" id="fc-file-frm-${e}" method="post" enctype="multipart/form-data">\n                <input type="file" id="fc-file-${e}" name="file" accept="image/x-png,image/gif,image/jpeg" />\n                <input type="hidden" id="fc-id-${e}" name="id" value="${e}">\n                <input type="hidden" id="fc-do-${e}" name="do" value="send_file">\n              </form>\n              <button class="fc-attachment-${fc_cfg.widget_id}" onclick="fc_send_file_fnc('${e}', '${n}', '${t}')" title="Send Image"><svg class="image-icon" xmlns="http://www.w3.org/2000/svg"\n         width="14" height="14" viewBox="0 0 24 24" fill="none" \n         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>\n        <circle cx="8.5" cy="8.5" r="2"/>\n        <path d="M21 21l-5-7-4 6-3-4-5 5"/>\n    </svg>\n    </button>\n              <button class="fc-submit-${fc_cfg.widget_id}" onclick="fc_send_text_message_fnc('${e}', '${n}', '${t}')" title="Send Message"><svg class="send-icon" xmlns="http://www.w3.org/2000/svg" \n         viewBox="0 0 576 512" width="14" height="14" fill="currentColor">\n        <path d="M290.5 287.7L491.4 86.9 359 456.3 290.5 287.7zM457.4 53L256.6 253.8 88 185.3 457.4 53zM38.1 216.8l205.8 83.6 83.6 205.8c5.3 13.1 18.1 21.7 32.3 21.7 14.7 0 27.8-9.2 32.8-23.1L570.6 8c3.5-9.8 1-20.6-6.3-28s-18.2-9.8-28-6.3L39.4 151.7c-13.9 5-23.1 18.1-23.1 32.8 0 14.2 8.6 27 21.7 32.3z"/>\n    </svg>\n    </button>\n            </div>\n          </div>`,m.appendChild(p);const h=document.getElementById(`fc-chat-dock-${fc_widget_id}`);if(!h)return;h.appendChild(m),i&&(fc_register_chat_window_fnc(e),fc_focus_chat_window_fnc(e)),fc_scroll_messages_bottom_fnc(e);const $=document.getElementById(`fc-text-input-${e}`);$&&$.addEventListener("keydown",(function(c){"Enter"!==c.key||c.shiftKey||(c.preventDefault(),fc_send_text_message_fnc(e,n,t))}))}function fc_updateSelf_fnc(e,c){if(!e||!fc_cfg||!c)return;const n=document.getElementById(`fc-self-info-${c}`);if(!n)return;const t=fc_cfg.widget_id,i=e.status?.toLowerCase()||"",f={avatar:n.querySelector(`.fc-dp-${t}`),nickname:n.querySelector(`.fc-nickname-${t}`),statusText:n.querySelector(`.fc-status-${t}`)};f.avatar&&e.gender&&(f.avatar.src=fc_dp_fnc(e.gender),f.avatar.alt=e.gender),f.nickname&&e.nickname&&(f.nickname.textContent=e.nickname),f.statusText&&e.status&&(f.statusText.textContent=e.status);const o=["fc-online","fc-away","fc-busy","fc-offline"].map((e=>`${e}-${t}`));[f.avatar,f.nickname].forEach((e=>{e&&(o.forEach((c=>e.classList.remove(c))),i&&e.classList.add(`fc-${i}-${t}`))}))}async function fc_loadTab_fnc(e,c,n){if(!fc_cfg||!fc_cfg.widget_id)return;const t=fc_cfg.widget_id;document.querySelectorAll(`.fc-tabContent-${t}`).forEach((e=>e.classList.remove(`fc-active-${t}`)));const i={chats:`fc-list-chats-${t}`,nearby:`fc-list-nearby-${t}`,rooms:`fc-list-rooms-${t}`}[e];if(!i)return;const f=document.getElementById(i);f&&f.classList.add(`fc-active-${t}`),"nearby"===e&&await fc_realTime_fnc("nearby",c,n)}