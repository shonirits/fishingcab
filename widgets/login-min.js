function fc_ensureWidgetStyles_fnc(){if(!fc_cfg?.widget_id)return;const e=`fc-widget-styles-${fc_cfg.widget_id}`;if(document.getElementById(e))return;const{widget_id:n,screen_bg_color:t="#fff",screen_text_color:i="#000",button_color:c="#260079"}=fc_cfg,d=document.createElement("style");d.id=e,d.textContent=`\n  :root {\n    --fc-bg-${n}: ${t};\n    --fc-text-${n}: ${i};\n    --fc-btn-${n}: ${c};\n  }\n\n  /* ===============================\n     Messenger Window\n  =============================== */\n  .fc-messenger-window-${n} {\n    position: fixed;\n    bottom: 80px;\n    right: 20px;\n    width: 360px;\n    max-width: 95vw;\n    max-height: 85vh;\n    display: flex;\n    flex-direction: column;\n    background: var(--fc-bg-${n});\n    color: var(--fc-text-${n});\n    border-radius: 12px;\n    box-shadow: 0 4px 16px rgba(0,0,0,0.25);\n    overflow-y: auto;\n    z-index: 9999;\n    opacity: 1;\n    transform: scale(1);\n    transition:\n      height 0.35s ease,\n      opacity 0.25s ease,\n      transform 0.25s ease;\n  }\n\n  .fc-messenger-window-${n}.fc-hidden-${n} {\n    height: 0;\n    opacity: 0;\n    transform: scale(0.96);\n    pointer-events: none;\n  }\n\n  /* ===============================\n     Signup Form\n  =============================== */\n  .fc-signup-form-${n} {\n    flex: 1;\n    padding: 20px;\n    text-align: center;\n    font-family: system-ui, sans-serif;\n    margin: 0 auto;\n    width: 100%;\n    max-width: 420px;\n  }\n\n  .fc-signup-input-${n},\n  .fc-signup-select-${n},\n  .fc-signup-button-${n} {\n    width: 100%;\n    padding: 12px;\n    margin-bottom: 15px;\n    border-radius: 8px;\n    font-size: 16px;\n    box-sizing: border-box;\n  }\n\n  .fc-signup-input-${n},\n  .fc-signup-select-${n} {\n    border: 1px solid #ccc;\n  }\n\n  .fc-signup-input.invalid-${n},\n  .fc-signup-select.invalid-${n} {\n    border-color: #e53935;\n  }\n\n  .fc-signup-input.valid-${n},\n  .fc-signup-select.valid-${n} {\n    border-color: #43a047;\n  }\n\n  .fc-signup-button-${n} {\n    border: none;\n    background: var(--fc-btn-${n});\n    color: #fff;\n    cursor: pointer;\n    transition: transform 0.15s ease, opacity 0.15s ease;\n  }\n\n  .fc-signup-button-${n}:active {\n    transform: scale(0.96);\n    opacity: 0.9;\n  }\n\n  .fc-signup-button-${n}:disabled {\n    opacity: 0.7;\n    cursor: not-allowed;\n  }\n\n  /* ===============================\n     Feedback\n  =============================== */\n  .fc-signup-error-${n} {\n    color: #e53935;\n    font-size: 13px;\n    text-align: left;\n    margin-top: -8px;\n    margin-bottom: 10px;\n  }\n\n  .fc-signup-valid-${n} {\n    color: #43a047;\n    font-size: 13px;\n    text-align: left;\n    margin-top: -8px;\n    margin-bottom: 10px;\n  }\n\n  /* ===============================\n     Shake Animation\n  =============================== */\n  @keyframes fc-signup-shake-${n} {\n    0% { transform: translateX(0); }\n    20% { transform: translateX(-5px); }\n    40% { transform: translateX(5px); }\n    60% { transform: translateX(-5px); }\n    80% { transform: translateX(5px); }\n    100% { transform: translateX(0); }\n  }\n\n  .fc-signup-shake-${n} {\n    animation: fc-signup-shake-${n} 0.4s;\n  }\n\n  /* ===============================\n     Footer\n  =============================== */\n  .fc-signup-footer-${n} {\n    font-size: 12px;\n    padding: 8px;\n    text-align: center;\n    background: #9667C7;\n    color: #260079;\n  }\n\n  .fc-signup-footer-${n} a {\n    color: inherit;\n    text-decoration: none;\n  }\n\n  /* ===============================\n     Mobile / Small Screens\n  =============================== */\n  @media (max-width: 320px), (max-height: 420px) {\n    .fc-messenger-window-${n} {\n      bottom: 0;\n      right: 0;\n      width: 100vw;\n      height: 100vh;\n      max-width: 100vw;\n      max-height: 100vh;\n      border-radius: 0;\n    }\n  }\n  `,document.head.appendChild(d)}function fc_addShake_fnc(e){e&&(e.classList.add(`fc-signup-shake-${fc_cfg.widget_id}`),setTimeout((()=>e.classList.remove(`fc-signup-shake-${fc_cfg.widget_id}`)),500))}function fc_validateField_fnc(e){const n=document.getElementById(`fc-signup-${e}-${fc_cfg.widget_id}`),t=document.getElementById(`fc-signup-error-${e}-${fc_cfg.widget_id}`);if(!n||!t)return;const i=n.value.trim();switch(t.textContent="",n.classList.remove("invalid","valid"),t.className=`fc-signup-error-${fc_cfg.widget_id}`,e){case"nickname":!i||i.length<3?(t.textContent="Nickname must be at least 3 characters.",n.classList.add("invalid"),fc_addShake_fnc(n)):(t.textContent="✓ Looks good!",t.className=`fc-signup-valid-${fc_cfg.widget_id}`,n.classList.add("valid"));break;case"gender":i?(t.textContent="✓ Looks good!",t.className=`fc-signup-valid-${fc_cfg.widget_id}`,n.classList.add("valid")):(t.textContent="Please select your gender.",n.classList.add("invalid"),fc_addShake_fnc(n));break;case"age":const e=parseInt(i,10);isNaN(e)||e<18||e>63?(t.textContent="Your Age must be between 18 and 63.",n.classList.add("invalid"),fc_addShake_fnc(n)):(t.textContent="✓ Looks good!",t.className=`fc-signup-valid-${fc_cfg.widget_id}`,n.classList.add("valid"));break;case"findgender":i?(t.textContent="✓ Looks good!",t.className=`fc-signup-valid-${fc_cfg.widget_id}`,n.classList.add("valid")):(t.textContent="Please select who you are looking for.",n.classList.add("invalid"),fc_addShake_fnc(n));break;case"agefrom":const c=parseInt(i,10);isNaN(c)||c<18||c>63?(t.textContent="Age From must be between 18 and 63.",n.classList.add("invalid"),fc_addShake_fnc(n)):(t.textContent="✓ Looks good!",t.className=`fc-signup-valid-${fc_cfg.widget_id}`,n.classList.add("valid"));break;case"ageto":const d=parseInt(i,10),a=parseInt(document.getElementById(`fc-signup-agefrom-${fc_cfg.widget_id}`)?.value,10);isNaN(d)||d<18||d>63?(t.textContent="Age To must be between 18 and 63.",n.classList.add("invalid"),fc_addShake_fnc(n)):!isNaN(a)&&d<a?(t.textContent="Age To cannot be less than Age From.",n.classList.add("invalid"),fc_addShake_fnc(n)):(t.textContent="✓ Looks good!",t.className=`fc-signup-valid-${fc_cfg.widget_id}`,n.classList.add("valid"))}}function fc_checkFormValidity_fnc(){let e=!0;["nickname","gender","age","findgender","agefrom","ageto"].forEach((n=>{fc_validateField_fnc(n);const t=document.getElementById(`fc-signup-error-${n}-${fc_cfg.widget_id}`);t&&t.textContent&&!t.textContent.includes("✓")&&(e=!1)}));const n=document.getElementById(`fc-step1-continue-${fc_cfg.widget_id}`);n&&(n.disabled=!e)}function fc_renderStep1_fnc(e){window.fc_cfg=e;const n=window.fc_cfg;if(!n||!n.widget_id)return;fc_ensureWidgetStyles_fnc();const t=document.getElementById(`fc-signup-step1-${n.widget_id}`);t&&(t.innerHTML=`\n    <div id="fc-signup-form-${n.widget_id}" class="fc-signup-form-${n.widget_id}">\n      <h3 style="margin-bottom:20px; color:${n.accent_color}; font-size:20px; font-weight:600;">\n        ${n.title}\n      </h3>\n\n      <div class="fc-signup-field-${n.widget_id}">\n        <input type="text" id="fc-signup-nickname-${n.widget_id}" class="fc-signup-input-${n.widget_id}" placeholder="Your Nickname" aria-label="Nickname">\n        <div id="fc-signup-error-nickname-${n.widget_id}" class="fc-signup-error-${n.widget_id}"></div>\n      </div>\n\n      <div class="fc-signup-field-${n.widget_id}">\n        <select id="fc-signup-gender-${n.widget_id}" class="fc-signup-select-${n.widget_id}" aria-label="Gender">\n          <option value="">Your Gender</option>\n          <option value="male">Male</option>\n          <option value="female">Female</option>\n          <option value="not_specified">Not Specified</option>\n        </select>\n        <div id="fc-signup-error-gender-${n.widget_id}" class="fc-signup-error-${n.widget_id}"></div>\n      </div>\n\n      <div class="fc-signup-field-${n.widget_id}">\n        <input type="number" id="fc-signup-age-${n.widget_id}" class="fc-signup-input-${n.widget_id}" placeholder="Your Age" aria-label="Age">\n        <div id="fc-signup-error-age-${n.widget_id}" class="fc-signup-error-${n.widget_id}"></div>\n      </div>\n\n      <div class="fc-signup-field-${n.widget_id}">\n        <select id="fc-signup-findgender-${n.widget_id}" class="fc-signup-select-${n.widget_id}" aria-label="Looking For">\n          <option value="">You Looking For</option>\n          <option value="male">Male</option>\n          <option value="female">Female</option>\n          <option value="any">Any</option>\n        </select>\n        <div id="fc-signup-error-findgender-${n.widget_id}" class="fc-signup-error-${n.widget_id}"></div>\n      </div>\n\n      <div class="fc-signup-field-${n.widget_id}">\n        <input type="number" id="fc-signup-agefrom-${n.widget_id}" class="fc-signup-input-${n.widget_id}" placeholder="Age From" aria-label="Age From">\n        <div id="fc-signup-error-agefrom-${n.widget_id}" class="fc-signup-error-${n.widget_id}"></div>\n      </div>\n\n      <div class="fc-signup-field-${n.widget_id}">\n        <input type="number" id="fc-signup-ageto-${n.widget_id}" class="fc-signup-input-${n.widget_id}" placeholder="Age To" aria-label="Age To">\n        <div id="fc-signup-error-ageto-${n.widget_id}" class="fc-signup-error-${n.widget_id}"></div>\n      </div>\n\n      <button id="fc-step1-continue-${n.widget_id}" class="fc-signup-button-${n.widget_id}" disabled>Continue</button>\n    </div>\n\n    <div class="fc-signup-footer-${n.widget_id}">\n      Powered by <a href="https://fishingcab.com" target="_blank" rel="noopener noreferrer">FishingCab.com</a>\n    </div>\n  `,requestAnimationFrame((()=>{["nickname","gender","age","findgender","agefrom","ageto"].forEach((e=>{const t=document.getElementById(`fc-signup-${e}-${n.widget_id}`);if(t){let n;t.addEventListener("input",(()=>{clearTimeout(n),n=setTimeout((()=>{fc_validateField_fnc(e),fc_checkFormValidity_fnc()}),200)})),t.addEventListener("change",(()=>{fc_validateField_fnc(e),fc_checkFormValidity_fnc()}))}}));const e=document.getElementById(`fc-step1-continue-${n.widget_id}`);e&&e.addEventListener("click",(t=>{if(t.preventDefault(),fc_checkFormValidity_fnc(),e.disabled)return;const i=document.getElementById(`fc-signup-step1-${n.widget_id}`),c=document.getElementById(`fc-signup-step2-${n.widget_id}`);i&&(i.style.display="none"),c&&(c.style.display="block"),fc_renderStep2_fnc()}))})))}function fc_renderStep2_fnc(){if(!window.fc_cfg||!fc_cfg.widget_id)return;const e=document.getElementById(`fc-signup-step2-${fc_cfg.widget_id}`);if(!e)return;e.innerHTML=`\n    <div class="fc-signup-form-${fc_cfg.widget_id}">\n      <h3 style="margin-bottom:12px; color:${fc_cfg.accent_color}; font-size:20px; font-weight:600;">\n        Getting location via GPS\n      </h3>\n      <p class="fc-lead-${fc_cfg.widget_id}" style="margin-bottom:10px;">\n        Always allow FishingCab to access your location for the best experience.\n      </p>\n      <p id="fc-geolocation-area-${fc_cfg.widget_id}" class="font-monospace-${fc_cfg.widget_id}">\n        <span class="fc-badge-info-${fc_cfg.widget_id}">Please Wait...</span>\n      </p>\n\n      <div style="display:flex; gap:8px; margin-top:16px;">\n        <button id="fc-location-retry-${fc_cfg.widget_id}" class="fc-signup-button-${fc_cfg.widget_id}" style="background:${fc_cfg.accent_color}; display:none;">Retry</button>\n        <button id="fc-location-continue-${fc_cfg.widget_id}" class="fc-signup-button-${fc_cfg.widget_id}" style="display:none;">Continue</button>\n      </div>\n      <button id="fc-back-step1-${fc_cfg.widget_id}" class="fc-signup-button-${fc_cfg.widget_id}" style="margin-top:8px; opacity:0.7;">\n        ← Back to Step 1\n      </button>\n    </div>\n\n    <div class="fc-signup-footer-${fc_cfg.widget_id}">\n      Powered by <a href="https://fishingcab.com" target="_blank" rel="noopener noreferrer">FishingCab.com</a>\n    </div>\n  `;const n=document.getElementById(`fc-geolocation-area-${fc_cfg.widget_id}`),t=document.getElementById(`fc-location-retry-${fc_cfg.widget_id}`),i=document.getElementById(`fc-location-continue-${fc_cfg.widget_id}`),c=document.getElementById(`fc-back-step1-${fc_cfg.widget_id}`);if(!(n&&t&&i&&c))return;const d=()=>{n.innerHTML=`<span class="fc-badge-info-${fc_cfg.widget_id}">Please Wait...</span>`,t.style.display="none",i.style.display="none",navigator.geolocation&&"function"==typeof navigator.geolocation.getCurrentPosition?navigator.geolocation.getCurrentPosition((e=>{window.fc_lat=e.coords.latitude,window.fc_lon=e.coords.longitude,n.innerHTML=`<span class="fc-badge-success-${fc_cfg.widget_id}">Location detected</span>`,i.style.display="inline-block"}),(e=>{let i="Location access denied or unavailable";if(e&&"number"==typeof e.code)switch(e.code){case 1:i="Location access denied by user";break;case 2:i="Location unavailable";break;case 3:i="Location request timed out"}n.innerHTML=`<span class="fc-badge-danger-${fc_cfg.widget_id}">${i}</span>`,t.style.display="inline-block"}),{enableHighAccuracy:!0,timeout:8e3,maximumAge:0}):(n.innerHTML=`<span class="fc-badge-warning-${fc_cfg.widget_id}">Geolocation not supported</span>`,t.style.display="inline-block")};d(),t.addEventListener("click",(e=>{e.preventDefault(),d()})),c.addEventListener("click",(e=>{e.preventDefault();const n=document.getElementById(`fc-signup-step1-${fc_cfg.widget_id}`),t=document.getElementById(`fc-signup-step2-${fc_cfg.widget_id}`),i=document.getElementById(`fc-signup-step3-${fc_cfg.widget_id}`);n&&(n.style.display="block"),i&&(i.style.display="none"),t&&(t.style.display="none"),fc_renderStep1_fnc(fc_cfg)})),i.addEventListener("click",(e=>{e.preventDefault();const n=document.getElementById(`fc-signup-step2-${fc_cfg.widget_id}`),t=document.getElementById(`fc-signup-step3-${fc_cfg.widget_id}`);t&&(t.style.display="block"),n&&(n.style.display="none"),fc_renderStep3_fnc()}))}function fc_renderStep3_fnc(){if(!fc_cfg||!fc_cfg.widget_id)return;const e=document.getElementById(`fc-signup-step3-${fc_cfg.widget_id}`);if(!e)return;e.innerHTML=`\n    <div class="fc-signup-form-${fc_cfg.widget_id}">\n      <h3 style="margin-bottom:20px; color:${fc_cfg.accent_color}; font-size:20px; font-weight:600;">\n        Verify you are human\n      </h3>\n      <div id="fc-captcha-box-${fc_cfg.widget_id}" style="position:relative; padding:16px; border:1px dashed #ccc; border-radius:8px; margin-bottom:16px; text-align:center;">\n        <img id="fc-captcha-img-${fc_cfg.widget_id}" alt="Captcha" style="display:block; margin:0 auto 12px auto; max-width:100%;">\n        <div id="fc-captcha-loading-${fc_cfg.widget_id}" style="color:#999; margin-bottom:8px; display:none;">Loading captcha...</div>\n        <svg id="fc-captcha-reload-${fc_cfg.widget_id}" xmlns="http://www.w3.org/2000/svg" \n             viewBox="0 0 24 24" width="24" height="24"\n             style="position:absolute; top:8px; right:8px; cursor:pointer; fill:${fc_cfg.accent_color};" aria-label="Reload captcha" role="img">\n          <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.66-.67 3.16-1.76 4.24l1.42 1.42C19.07 16.07 20 14.13 20 12c0-4.42-3.58-8-8-8zm-6.24 2.76L4.34 8.18C3.93 9.07 3.67 10.01 3.67 11c0 4.42 3.58 8 8 8v3l4-4-4-4v3c-3.31 0-6-2.69-6-6 0-.99.26-1.93.76-2.76z"/>\n        </svg>\n        <input type="text" id="fc-captcha-code-${fc_cfg.widget_id}" class="fc-signup-input-${fc_cfg.widget_id}" \n               placeholder="Enter code shown above" style="text-align:center;" aria-label="Captcha code">\n        <div id="fc-captcha-error-${fc_cfg.widget_id}" class="fc-signup-error-${fc_cfg.widget_id}" aria-live="polite"></div>\n      </div>\n      <button id="fc-captcha-submit-${fc_cfg.widget_id}" class="fc-signup-button-${fc_cfg.widget_id}">Finish & Sign Up</button>\n      <button id="fc-back-step2-${fc_cfg.widget_id}" class="fc-signup-button-${fc_cfg.widget_id}" style="margin-top:8px; opacity:0.7;">\n        ← Back to Step 2\n      </button>\n    </div>\n    <div class="fc-signup-footer-${fc_cfg.widget_id}">\n      Powered by <a href="https://fishingcab.com" target="_blank" rel="noopener noreferrer">FishingCab.com</a>\n    </div>\n  `;const n=document.getElementById(`fc-captcha-img-${fc_cfg.widget_id}`),t=document.getElementById(`fc-captcha-loading-${fc_cfg.widget_id}`),i=document.getElementById(`fc-captcha-error-${fc_cfg.widget_id}`),c=document.getElementById(`fc-captcha-submit-${fc_cfg.widget_id}`),d=document.getElementById(`fc-captcha-reload-${fc_cfg.widget_id}`),a=document.getElementById(`fc-back-step2-${fc_cfg.widget_id}`);if(!(n&&t&&i&&c&&d&&a))return;let o=null,s=!1;function f(){t.style.display="block",n.style.display="none",i.textContent="",fetch(`${fc_base_url}get_captcha_token/${fc_cfg.widget_id}`,{method:"GET",headers:{Accept:"application/json"}}).then((e=>e.json())).then((e=>{if(!e||!0!==e.status||!e.data)return i.textContent="Failed to load captcha",void(t.style.display="none");o=e.data,n.src=`${fc_cdn_url}Api/get_captcha_image/${encodeURIComponent(o)}`})).catch((()=>{t.style.display="none",i.textContent="Captcha service unavailable"}))}n.onload=()=>{t.style.display="none",n.style.display="block"},n.onerror=()=>{t.style.display="none",i.textContent="Failed to load captcha image"},d.addEventListener("click",(e=>{e.preventDefault(),s||(s=!0,f(),setTimeout((()=>{s=!1}),600))})),c.addEventListener("click",(e=>{e.preventDefault();const n=document.getElementById(`fc-captcha-code-${fc_cfg.widget_id}`);if(!n)return;const t=n.value.trim();if(!t||t.length<3){i.textContent="Please enter at least 3 characters.";return void fc_addShake_fnc(document.getElementById(`fc-captcha-box-${fc_cfg.widget_id}`))}i.textContent="",c.disabled=!0,c.textContent="Signing up...";const d=(e=>{const n=e<=0?"+":"-",t=Math.abs(e);return`${n}${String(Math.floor(t/60)).padStart(2,"0")}:${String(t%60).padStart(2,"0")}`})((new Date).getTimezoneOffset()),a={token:o||"",captcha_code:t,nickname:(document.getElementById(`fc-signup-nickname-${fc_cfg.widget_id}`)?.value||"").trim(),gender:document.getElementById(`fc-signup-gender-${fc_cfg.widget_id}`)?.value||"",age:document.getElementById(`fc-signup-age-${fc_cfg.widget_id}`)?.value||"",findgender:document.getElementById(`fc-signup-findgender-${fc_cfg.widget_id}`)?.value||"",agefrom:document.getElementById(`fc-signup-agefrom-${fc_cfg.widget_id}`)?.value||"",ageto:document.getElementById(`fc-signup-ageto-${fc_cfg.widget_id}`)?.value||"",latitude:window.fc_lat||"",longitude:window.fc_lon||"",offset:d},s=new URLSearchParams(a);fetch(`${fc_base_url}login/${fc_cfg.widget_id}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:s.toString()}).then((e=>e.json())).then((e=>{if(e&&!0===e.status&&e.data){fc_setCookie_fnc("fc_user_public_key",e.data.public_key),fc_setCookie_fnc("fc_user_secret_key",e.data.secret_key);const n=document.getElementById(`fc-messenger-wizard-${fc_cfg.widget_id}`);n&&(n.innerHTML=`\n              <div class="fc-signup-form-${fc_cfg.widget_id}">\n                <h3 style="color:${fc_cfg.accent_color};">Signup complete</h3>\n                <p>Loading chats...</p>\n              </div>\n            `),fc_loadScript_fnc("messenger-min.js",(async()=>{if("function"==typeof fc_showMessenger_fnc){fc_showMessenger_fnc(fc_cfg,e.data.public_key,e.data.secret_key);try{await fc_realTime_fnc("initialize",e.data.public_key,e.data.secret_key,"","",(function(){fc_getUpdates_fnc("initialize",fc_cfg,e.data.public_key,e.data.secret_key)}))}catch(e){console.error("Messenger init failed:",e)}}}))}else{let n="Unknown error";e&&e.messages&&e.messages.error?n=e.messages.error:e&&e.data&&(n=e.data),i.textContent=n;fc_addShake_fnc(document.getElementById(`fc-captcha-box-${fc_cfg.widget_id}`)),f()}})).catch((()=>{i.textContent="Network error during signup."})).finally((()=>{c.disabled=!1,c.textContent="Finish & Sign Up"}))})),a.addEventListener("click",(e=>{e.preventDefault();const n=document.getElementById(`fc-signup-step1-${fc_cfg.widget_id}`),t=document.getElementById(`fc-signup-step2-${fc_cfg.widget_id}`),i=document.getElementById(`fc-signup-step3-${fc_cfg.widget_id}`);n&&(n.style.display="none"),i&&(i.style.display="none"),t&&(t.style.display="block"),fc_renderStep2_fnc()})),f()}"undefined"==typeof fc_cfg&&(fc_cfg=window.fc_cfg||{}),fc_base_url="https://widgets.fishingcab.com/Widgets/",fc_cdn_url="https://cdn-widgets.fishingcab.com/";